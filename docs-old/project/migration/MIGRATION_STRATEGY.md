# üîÑ –°–¢–†–ê–¢–ï–ì–ò–Ø –ú–ò–ì–†–ê–¶–ò–ò FEMCL

## üìã –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞
–î–∞–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –º–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö Fish_Eye –∏–∑ MS SQL Server –≤ PostgreSQL –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –æ—Å–Ω–æ–≤–Ω—ã–º –∑–∞–º—ã—Å–ª–æ–º –ø—Ä–æ–µ–∫—Ç–∞.

---

## üéØ –û–ë–ó–û–† –°–¢–†–ê–¢–ï–ì–ò–ò

### üìä –ö–æ–Ω—Ü–µ–ø—Ü–∏—è
–°—Ç—Ä–∞—Ç–µ–≥–∏—è –æ—Å–Ω–æ–≤–∞–Ω–∞ –Ω–∞ **–¥–≤—É—Ö—ç—Ç–∞–ø–Ω–æ–º –ø–æ–¥—Ö–æ–¥–µ** —Å —á–µ—Ç–∫–∏–º —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏:

```
–≠—Ç–∞–ø 1: –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –∏ –ø–µ—Ä–µ–Ω–æ—Å –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ 1.1: –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö —Ü–µ–ª–µ–≤–æ–π —Å—Ö–µ–º—ã
‚îî‚îÄ‚îÄ 1.2: –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤ –∏ –ø–µ—Ä–µ–Ω–æ—Å –¥–∞–Ω–Ω—ã—Ö

–≠—Ç–∞–ø 2: –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –ë–î
‚îú‚îÄ‚îÄ –ò–Ω–¥–µ–∫—Å—ã
‚îú‚îÄ‚îÄ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
‚îú‚îÄ‚îÄ –¢—Ä–∏–≥–≥–µ—Ä—ã
‚îú‚îÄ‚îÄ –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è
‚îî‚îÄ‚îÄ –§—É–Ω–∫—Ü–∏–∏ –∏ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã
```

**–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ:** [MIGRATION_ALGORITHM.md](../overview/MIGRATION_ALGORITHM.md)

---

## üìã –≠–¢–ê–ü 1: –§–û–†–ú–ò–†–û–í–ê–ù–ò–ï –¢–ê–ë–õ–ò–¶ –ò –ü–ï–†–ï–ù–û–° –î–ê–ù–ù–´–•

### üîß **–≠—Ç–∞–ø 1.1: –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö —Ü–µ–ª–µ–≤–æ–π —Å—Ö–µ–º—ã**

#### üéØ –¶–µ–ª—å
–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª–Ω—ã—Ö –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü —Ü–µ–ª–µ–≤–æ–π —Å—Ö–µ–º—ã PostgreSQL –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ö–æ–¥–Ω–æ–π —Å—Ö–µ–º—ã MS SQL Server.

#### üìä –ü—Ä–æ—Ü–µ—Å—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

##### 1. **–ê–Ω–∞–ª–∏–∑ –∏—Å—Ö–æ–¥–Ω–æ–π —Å—Ö–µ–º—ã**
```sql
-- –ê–Ω–∞–ª–∏–∑ —Ç–∞–±–ª–∏—Ü MS SQL Server
SELECT 
    TABLE_NAME,
    TABLE_TYPE,
    TABLE_SCHEMA
FROM INFORMATION_SCHEMA.TABLES
WHERE TABLE_SCHEMA = 'ags'
ORDER BY TABLE_NAME;
```

##### 2. **–ê–Ω–∞–ª–∏–∑ –∫–æ–ª–æ–Ω–æ–∫**
```sql
-- –ê–Ω–∞–ª–∏–∑ –∫–æ–ª–æ–Ω–æ–∫ MS SQL Server
SELECT 
    TABLE_NAME,
    COLUMN_NAME,
    DATA_TYPE,
    IS_NULLABLE,
    COLUMN_DEFAULT,
    CHARACTER_MAXIMUM_LENGTH,
    NUMERIC_PRECISION,
    NUMERIC_SCALE
FROM INFORMATION_SCHEMA.COLUMNS
WHERE TABLE_SCHEMA = 'ags'
ORDER BY TABLE_NAME, ORDINAL_POSITION;
```

##### 3. **–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∫–æ–ª–ª–∏–∑–∏–π –º–µ–∂–¥—É –°–£–ë–î**
- **–ú–∞–ø–ø–∏–Ω–≥ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö:** MS SQL ‚Üí PostgreSQL
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π:** CONVERT, CAST, ISNULL
- **–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ —Ä–∞–∑–ª–∏—á–∏–π –≤ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–µ:** TOP ‚Üí LIMIT, IDENTITY ‚Üí SERIAL

##### 4. **–°–æ–∑–¥–∞–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –≤ —Å—Ö–µ–º–µ mcl**
```sql
-- –°–æ–∑–¥–∞–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü
INSERT INTO mcl.tables (table_name, source_schema, target_schema, status)
SELECT 
    TABLE_NAME,
    'ags' as source_schema,
    'ags' as target_schema,
    'pending' as status
FROM INFORMATION_SCHEMA.TABLES
WHERE TABLE_SCHEMA = 'ags';

-- –°–æ–∑–¥–∞–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –∫–æ–ª–æ–Ω–æ–∫
INSERT INTO mcl.columns (table_name, column_name, source_type, target_type, is_nullable, default_value)
SELECT 
    TABLE_NAME,
    COLUMN_NAME,
    DATA_TYPE as source_type,
    CASE 
        WHEN DATA_TYPE = 'varchar' THEN 'VARCHAR'
        WHEN DATA_TYPE = 'int' THEN 'INTEGER'
        WHEN DATA_TYPE = 'datetime' THEN 'TIMESTAMP'
        -- ... –¥—Ä—É–≥–∏–µ –º–∞–ø–ø–∏–Ω–≥–∏
    END as target_type,
    IS_NULLABLE = 'YES' as is_nullable,
    COLUMN_DEFAULT as default_value
FROM INFORMATION_SCHEMA.COLUMNS
WHERE TABLE_SCHEMA = 'ags';
```

#### ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
- [ ] –í—Å–µ —Ç–∞–±–ª–∏—Ü—ã –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã
- [ ] –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Å–æ–∑–¥–∞–Ω—ã –≤ —Å—Ö–µ–º–µ mcl
- [ ] –ö–æ–ª–ª–∏–∑–∏–∏ –º–µ–∂–¥—É –°–£–ë–î —Ä–∞–∑—Ä–µ—à–µ–Ω—ã
- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–π–¥–µ–Ω–∞

---

### üîÑ **–≠—Ç–∞–ø 1.2: –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤ –∏ –ø–µ—Ä–µ–Ω–æ—Å –¥–∞–Ω–Ω—ã—Ö**

#### üéØ –¶–µ–ª—å
–°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö —Ç–∞–±–ª–∏—Ü –≤ PostgreSQL –∏ –ø–µ—Ä–µ–Ω–æ—Å –¥–∞–Ω–Ω—ã—Ö —Å —É—á–µ—Ç–æ–º —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç–∏ —Ç–∞–±–ª–∏—Ü. **–í–∫–ª—é—á–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–±—ä–µ–∫—Ç–æ–≤ —Ç–∞–±–ª–∏—Ü (–∏–Ω–¥–µ–∫—Å—ã, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è, —Ç—Ä–∏–≥–≥–µ—Ä—ã) —Å–æ–≤–º–µ—Å—Ç–Ω–æ —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏.**

#### üìä –ê–ª–≥–æ—Ä–∏—Ç–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

##### 1. **–ê–Ω–∞–ª–∏–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π**
```sql
-- –ê–Ω–∞–ª–∏–∑ –≤–Ω–µ—à–Ω–∏—Ö –∫–ª—é—á–µ–π MS SQL Server
SELECT 
    fk.TABLE_NAME as child_table,
    fk.COLUMN_NAME as child_column,
    pk.TABLE_NAME as parent_table,
    pk.COLUMN_NAME as parent_column
FROM INFORMATION_SCHEMA.REFERENTIAL_CONSTRAINTS rc
JOIN INFORMATION_SCHEMA.KEY_COLUMN_USAGE fk 
    ON rc.CONSTRAINT_NAME = fk.CONSTRAINT_NAME
JOIN INFORMATION_SCHEMA.KEY_COLUMN_USAGE pk 
    ON rc.UNIQUE_CONSTRAINT_NAME = pk.CONSTRAINT_NAME
WHERE fk.TABLE_SCHEMA = 'ags';
```

##### 2. **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ—Ä—è–¥–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏**
- **–¢–∞–±–ª–∏—Ü—ã –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö –∫–ª—é—á–µ–π** - –º–∏–≥—Ä–∏—Ä—É—é—Ç—Å—è –ø–µ—Ä–≤—ã–º–∏
- **–¢–∞–±–ª–∏—Ü—ã —Å –≤–Ω–µ—à–Ω–∏–º–∏ –∫–ª—é—á–∞–º–∏** - –º–∏–≥—Ä–∏—Ä—É—é—Ç—Å—è –ø–æ—Å–ª–µ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏—Ö —Ç–∞–±–ª–∏—Ü
- **–¶–∏–∫–ª–∏—á–µ—Å–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏** - —Ä–∞–∑—Ä–µ—à–∞—é—Ç—Å—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–º–∏ –∞–ª–≥–æ—Ä–∏—Ç–º–∞–º–∏

##### 3. **–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è —Ç–∞–±–ª–∏—Ü**
```python
def migrate_table_sequence():
    """–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è —Ç–∞–±–ª–∏—Ü —Å —É—á–µ—Ç–æ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π"""
    
    # –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ç–∞–±–ª–∏—Ü –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ
    tables = get_migration_order()
    
    for table in tables:
        try:
            # –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–∞–±–ª–∏—Ü—ã
            create_table_structure(table)
            
            # –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ —Ç–∞–±–ª–∏—Ü—ã
            create_table_indexes(table)
            
            # –°–æ–∑–¥–∞–Ω–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π —Ç–∞–±–ª–∏—Ü—ã
            create_table_constraints(table)
            
            # –°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤ —Ç–∞–±–ª–∏—Ü—ã (–ø—Ä–æ—Å—Ç—ã–µ –∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ)
            create_table_triggers(table)
            
            # –ü–µ—Ä–µ–Ω–æ—Å –¥–∞–Ω–Ω—ã—Ö
            migrate_table_data(table)
            
            # –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–µ—Ä–µ–Ω–æ—Å–∞
            validate_migration(table)
            
            # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
            update_migration_status(table, 'completed')
            
        except Exception as e:
            # –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
            log_error(table, e)
            update_migration_status(table, 'failed')
            raise
```

##### 4. **–°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–∞–±–ª–∏—Ü—ã**
```sql
-- –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –≤ PostgreSQL
CREATE TABLE ags.table_name (
    column1 INTEGER NOT NULL,
    column2 VARCHAR(255),
    column3 TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (column1)
);
```

##### 5. **–ü–µ—Ä–µ–Ω–æ—Å –¥–∞–Ω–Ω—ã—Ö**
```python
def migrate_table_data(table_name):
    """–ü–µ—Ä–µ–Ω–æ—Å –¥–∞–Ω–Ω—ã—Ö –∏–∑ MS SQL Server –≤ PostgreSQL"""
    
    # –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ MS SQL Server
    source_data = get_source_data(table_name)
    
    # –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
    transformed_data = transform_data(source_data)
    
    # –í—Å—Ç–∞–≤–∫–∞ –≤ PostgreSQL
    insert_target_data(table_name, transformed_data)
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–ø–∏—Å–µ–π
    validate_record_count(table_name)
```

##### 6. **–í–∞–ª–∏–¥–∞—Ü–∏—è –ø–µ—Ä–µ–Ω–æ—Å–∞**
```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–ø–∏—Å–µ–π
SELECT 
    (SELECT COUNT(*) FROM mssql.ags.table_name) as source_count,
    (SELECT COUNT(*) FROM postgres.ags.table_name) as target_count;

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö
SELECT 
    COUNT(*) as total_records,
    COUNT(DISTINCT primary_key) as unique_records
FROM postgres.ags.table_name;
```

#### ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
- [ ] –í—Å–µ 166 —Ç–∞–±–ª–∏—Ü —Å–æ–∑–¥–∞–Ω—ã –≤ PostgreSQL
- [ ] –í—Å–µ –∏–Ω–¥–µ–∫—Å—ã —Ç–∞–±–ª–∏—Ü —Å–æ–∑–¥–∞–Ω—ã
- [ ] –í—Å–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü —Å–æ–∑–¥–∞–Ω—ã
- [ ] –ü—Ä–æ—Å—Ç—ã–µ –∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã —Ç–∞–±–ª–∏—Ü —Å–æ–∑–¥–∞–Ω—ã
- [ ] –°–ª–æ–∂–Ω—ã–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã –æ—Ç–ª–æ–∂–µ–Ω—ã –Ω–∞ –≠—Ç–∞–ø 2
- [ ] –í—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã
- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ–π–¥–µ–Ω–∞ –¥–ª—è –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü
- [ ] –°—Ç–∞—Ç—É—Å –º–∏–≥—Ä–∞—Ü–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω

---

## üìã –≠–¢–ê–ü 2: –°–û–ó–î–ê–ù–ò–ï –ò–ù–´–• –û–ë–™–ï–ö–¢–û–í –ë–î

### üéØ –¶–µ–ª—å
–°–æ–∑–¥–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, **–Ω–µ —è–≤–ª—è—é—â–∏—Ö—Å—è —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ —Ç–∞–±–ª–∏—Ü**, –∫–æ—Ç–æ—Ä—ã–µ —Å—Å—ã–ª–∞—é—Ç—Å—è –Ω–∞ —Ç–∞–±–ª–∏—Ü—ã, —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –Ω–∞ —ç—Ç–∞–ø–µ 1.

### üìä –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–æ–∑–¥–∞–Ω–∏—è

#### 1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Ç–∏–ø—ã**
```sql
-- –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Ç–∏–ø–æ–≤
CREATE TYPE ags.status_type AS ENUM ('active', 'inactive', 'pending');
CREATE TYPE ags.priority_type AS ENUM ('low', 'medium', 'high', 'critical');
```

#### 2. **–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**
```sql
-- –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∑–Ω–∞—á–µ–Ω–∏–π
CREATE SEQUENCE ags.seq_order_number START 1000;
CREATE SEQUENCE ags.seq_invoice_number START 1;
```

#### 3. **–§—É–Ω–∫—Ü–∏–∏ (—Ç–∞–±–ª–∏—á–Ω—ã–µ –∏ —Å–∫–∞–ª—è—Ä–Ω—ã–µ)**
```sql
-- –°–æ–∑–¥–∞–Ω–∏–µ —Å–∫–∞–ª—è—Ä–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
CREATE OR REPLACE FUNCTION ags.calculate_total(amount DECIMAL)
RETURNS DECIMAL AS $$
BEGIN
    RETURN amount * 1.2; -- –ù–î–° 20%
END;
$$ LANGUAGE plpgsql;

-- –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—á–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
CREATE OR REPLACE FUNCTION ags.get_user_orders(user_id INTEGER)
RETURNS TABLE(order_id INTEGER, order_date DATE, total_amount DECIMAL) AS $$
BEGIN
    RETURN QUERY
    SELECT o.id, o.order_date, o.total_amount
    FROM ags.orders o
    WHERE o.user_id = user_id;
END;
$$ LANGUAGE plpgsql;
```

#### 4. **–•—Ä–∞–Ω–∏–º—ã–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã**
```sql
-- –°–æ–∑–¥–∞–Ω–∏–µ —Ö—Ä–∞–Ω–∏–º—ã—Ö –ø—Ä–æ—Ü–µ–¥—É—Ä
CREATE OR REPLACE PROCEDURE ags.process_order(
    IN p_user_id INTEGER,
    IN p_order_data JSON,
    OUT p_order_id INTEGER
) AS $$
BEGIN
    -- –õ–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–∫–∞–∑–∞
    INSERT INTO ags.orders (user_id, order_data, created_at)
    VALUES (p_user_id, p_order_data, CURRENT_TIMESTAMP)
    RETURNING id INTO p_order_id;
    
    -- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
    PERFORM ags.update_user_statistics(p_user_id);
END;
$$ LANGUAGE plpgsql;
```

#### 5. **–ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è**
```sql
-- –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π –¥–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞
CREATE VIEW ags.user_orders_summary AS
SELECT 
    u.id as user_id,
    u.name as user_name,
    COUNT(o.id) as total_orders,
    SUM(o.total_amount) as total_spent
FROM ags.users u
LEFT JOIN ags.orders o ON u.id = o.user_id
GROUP BY u.id, u.name;
```

#### 6. **–ü—Ä–∞–≤–∏–ª–∞ –∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã**
```sql
-- –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏
CREATE RULE ags.orders_audit_rule AS
    ON INSERT TO ags.orders
    DO ALSO
    INSERT INTO ags.audit_log (table_name, operation, record_id, timestamp)
    VALUES ('orders', 'INSERT', NEW.id, CURRENT_TIMESTAMP);

-- –°–æ–∑–¥–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤
CREATE OPERATOR ags.@> (LEFTARG = JSONB, RIGHTARG = JSONB)
    FUNCTION jsonb_contains;
```

#### 7. **–ê–≥—Ä–µ–≥–∞—Ç—ã**
```sql
-- –°–æ–∑–¥–∞–Ω–∏–µ –∞–≥—Ä–µ–≥–∞—Ç–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
CREATE OR REPLACE FUNCTION ags.median_final(state DECIMAL[])
RETURNS DECIMAL AS $$
BEGIN
    -- –õ–æ–≥–∏–∫–∞ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –º–µ–¥–∏–∞–Ω—ã
    RETURN state[array_length(state, 1) / 2];
END;
$$ LANGUAGE plpgsql;

CREATE AGGREGATE ags.median(DECIMAL) (
    SFUNC = array_append,
    STYPE = DECIMAL[],
    FINALFUNC = ags.median_final
);
```

---

## üîÑ –£–ü–†–ê–í–õ–ï–ù–ò–ï –ü–†–û–¶–ï–°–°–û–ú –ú–ò–ì–†–ê–¶–ò–ò

### üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
- **–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞** –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü—ã
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π** –≤ —Å—Ö–µ–º–µ mcl
- **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö** –∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö
- **–û—Ç—á–µ—Ç—ã –æ –ø—Ä–æ–≥—Ä–µ—Å—Å–µ** –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

### üö® –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–∫–∞—Ç** –ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–∫–∞—Ö
- **–†—É—á–Ω–æ–µ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–æ** –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤
- **–ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏** –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–±–æ–µ–≤
- **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º** –∏ —Ä–µ—à–µ–Ω–∏–π

### üîß –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö —Ç–∞–±–ª–∏—Ü
- **–ë–∞—Ç—á–µ–≤–∞—è –≤—Å—Ç–∞–≤–∫–∞** –¥–∞–Ω–Ω—ã—Ö
- **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤** –¥–ª—è –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤** —Å–∏—Å—Ç–µ–º—ã

---

## üìä –ö–†–ò–¢–ï–†–ò–ò –£–°–ü–ï–•–ê

### ‚úÖ **–≠—Ç–∞–ø 1.1 - –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ**
- [ ] 166 —Ç–∞–±–ª–∏—Ü –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã
- [ ] –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Å–æ–∑–¥–∞–Ω—ã –≤ —Å—Ö–µ–º–µ mcl
- [ ] –ö–æ–ª–ª–∏–∑–∏–∏ –º–µ–∂–¥—É –°–£–ë–î —Ä–∞–∑—Ä–µ—à–µ–Ω—ã
- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–π–¥–µ–Ω–∞

### ‚úÖ **–≠—Ç–∞–ø 1.2 - –¢–∞–±–ª–∏—Ü—ã –∏ –¥–∞–Ω–Ω—ã–µ**
- [ ] –í—Å–µ 166 —Ç–∞–±–ª–∏—Ü —Å–æ–∑–¥–∞–Ω—ã –≤ PostgreSQL
- [ ] –í—Å–µ –∏–Ω–¥–µ–∫—Å—ã —Ç–∞–±–ª–∏—Ü —Å–æ–∑–¥–∞–Ω—ã
- [ ] –í—Å–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ç–∞–±–ª–∏—Ü —Å–æ–∑–¥–∞–Ω—ã
- [ ] –ü—Ä–æ—Å—Ç—ã–µ –∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã —Ç–∞–±–ª–∏—Ü —Å–æ–∑–¥–∞–Ω—ã
- [ ] –°–ª–æ–∂–Ω—ã–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã –æ—Ç–ª–æ–∂–µ–Ω—ã –Ω–∞ –≠—Ç–∞–ø 2
- [ ] –í—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –±–µ–∑ –ø–æ—Ç–µ—Ä—å
- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–π–¥–µ–Ω–∞
- [ ] –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º

### ‚úÖ **–≠—Ç–∞–ø 2 - –ò–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã**
- [ ] –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Ç–∏–ø—ã —Å–æ–∑–¥–∞–Ω—ã
- [ ] –í—Å–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å–æ–∑–¥–∞–Ω—ã
- [ ] –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ (—Ç–∞–±–ª–∏—á–Ω—ã–µ –∏ —Å–∫–∞–ª—è—Ä–Ω—ã–µ) —Å–æ–∑–¥–∞–Ω—ã
- [ ] –í—Å–µ —Ö—Ä–∞–Ω–∏–º—ã–µ –ø—Ä–æ—Ü–µ–¥—É—Ä—ã —Å–æ–∑–¥–∞–Ω—ã
- [ ] –í—Å–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Å–æ–∑–¥–∞–Ω—ã
- [ ] –í—Å–µ –ø—Ä–∞–≤–∏–ª–∞ –∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã —Å–æ–∑–¥–∞–Ω—ã
- [ ] –í—Å–µ –∞–≥—Ä–µ–≥–∞—Ç—ã —Å–æ–∑–¥–∞–Ω—ã
- [ ] –°–ª–æ–∂–Ω—ã–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏ —Å–æ–∑–¥–∞–Ω—ã

---

## üéØ –ü–õ–ê–ù–´ –†–ê–ó–í–ò–¢–ò–Ø

### üîÑ **–ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ (1-2 –Ω–µ–¥–µ–ª–∏)**
- –ó–∞–≤–µ—Ä—à–∏—Ç—å —ç—Ç–∞–ø 1.2 - –º–∏–≥—Ä–∞—Ü–∏—è –≤—Å–µ—Ö 166 —Ç–∞–±–ª–∏—Ü
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Å—Ç—ã—Ö —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–Ω–æ—Å–∞ –¥–∞–Ω–Ω—ã—Ö
- –£–ª—É—á—à–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

### üöÄ **–°—Ä–µ–¥–Ω–µ—Å—Ä–æ—á–Ω—ã–µ (1-2 –º–µ—Å—è—Ü–∞)**
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —ç—Ç–∞–ø 2 - —Å–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –ë–î
- –ê–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã –≤—Ä—É—á–Ω—É—é
- –°–æ–∑–¥–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –î–æ–±–∞–≤–∏—Ç—å –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### üåü **–î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ (3-6 –º–µ—Å—è—Ü–µ–≤)**
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥—Ä—É–≥–∏—Ö –°–£–ë–î
- –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–∞–º–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

### üîÑ –ê–ª–≥–æ—Ä–∏—Ç–º –º–∏–≥—Ä–∞—Ü–∏–∏
- **[MIGRATION_ALGORITHM.md](../overview/MIGRATION_ALGORITHM.md)** - –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã
- **[MODULE_ARCHITECTURE.md](../architecture/MODULE_ARCHITECTURE.md)** - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª–µ–π

### üîß –°–∏—Å—Ç–µ–º–∞ –º–∞–ø–ø–∏–Ω–≥–∞ —Ñ—É–Ω–∫—Ü–∏–π
- **[FUNCTION_MAPPING_SYSTEM.md](./FUNCTION_MAPPING_SYSTEM.md)** - –°–∏—Å—Ç–µ–º–∞ –º–∞–ø–ø–∏–Ω–≥–∞ —Ñ—É–Ω–∫—Ü–∏–π MS SQL ‚Üí PostgreSQL

### üö® –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- **[ERROR_HANDLING.md](../development/ERROR_HANDLING.md)** - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ

### üìä –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞
- **[CRITERIA_SUCCESS.md](../development/CRITERIA_SUCCESS.md)** - –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞ –º–∏–≥—Ä–∞—Ü–∏–∏

---

*–î–æ–∫—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω: 27 —è–Ω–≤–∞—Ä—è 2025*
*–ê–≤—Ç–æ—Ä: AI Assistant*
*–°—Ç–∞—Ç—É—Å: –ê–ö–¢–£–ê–õ–¨–ù–´–ô*