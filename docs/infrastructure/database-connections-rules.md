# –ü—Ä–∞–≤–∏–ª–∞ —Ä–∞–±–æ—Ç—ã —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è–º–∏ –∫ –±–∞–∑–∞–º –¥–∞–Ω–Ω—ã—Ö FEMCL

**–í–µ—Ä—Å–∏—è:** 1.0.0  
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-10-07  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-10-07  
**–ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è:** –†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ + –†–µ–∂–∏–º —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏  
**–ê–≤—Ç–æ—Ä:** –ê–ª–µ–∫—Å–∞–Ω–¥—Ä

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–ü—Ä–∏–Ω—Ü–∏–ø—ã](#–ø—Ä–∏–Ω—Ü–∏–ø—ã)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
3. [–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ ConnectionManager](#–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ-connectionmanager)
4. [–ü—Ä–∞–≤–∏–ª–∞ –¥–ª—è AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞](#–ø—Ä–∞–≤–∏–ª–∞-–¥–ª—è-ai-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞)
5. [–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞](#—Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥-—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ-–∫–æ–¥–∞)
6. [–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π](#–¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞-–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π)
7. [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ connections.json](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-connectionsjson)
8. [–†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã](#—Ä–µ–∂–∏–º—ã-—Ä–∞–±–æ—Ç—ã)
9. [–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å](#–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)
10. [–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫](#–æ–±—Ä–∞–±–æ—Ç–∫–∞-–æ—à–∏–±–æ–∫)
11. [FAQ](#—á–∞—Å—Ç–æ-–∑–∞–¥–∞–≤–∞–µ–º—ã–µ-–≤–æ–ø—Ä–æ—Å—ã)

---

## –ü—Ä–∏–Ω—Ü–∏–ø—ã

### üéØ –ï–¥–∏–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π

- **–í—Å–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è** (–≤ –ª—é–±–æ–º —Ä–µ–∂–∏–º–µ) –∏—Å–ø–æ–ª—å–∑—É—é—Ç `connections.json`
- **–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é:** task_id=2 (–æ—Å–Ω–æ–≤–Ω–∞—è —Ç–µ—Å—Ç–æ–≤–∞—è –∑–∞–¥–∞—á–∞)
- **–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç:** `ConnectionManager` + `ConnectionProfileLoader`

### üìÅ –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

| –§–∞–π–ª | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è |
|------|------------|------------------|
| `src/code/infrastructure/config/connections.json` | –ü—Ä–æ—Ñ–∏–ª–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∫ –ë–î | **–í–°–ï –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è** (—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ + —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—è) |
| `src/code/infrastructure/config/config.yaml` | –û–±—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ | –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—Ä–æ—Ü–µ—Å—Å–∞ (batch_size, timeout, log_level) |

**–í–∞–∂–Ω–æ:** `config.yaml` –ù–ï —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î!

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –°—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã

```
connections.json (task_id=2 –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
    ‚Üì
ConnectionProfileLoader (–∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è)
    ‚Üì
ConnectionManager (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è–º–∏)
    ‚Üì
–í–∞—à –∫–æ–¥ –º–∏–≥—Ä–∞—Ü–∏–∏
```

### –ö–ª–∞—Å—Å—ã –∏ –∏—Ö —Ä–æ–ª–∏

| –ö–ª–∞—Å—Å | –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ | –†–æ–ª—å |
|-------|-------------|------|
| `ConnectionProfileLoader` | `src/code/infrastructure/classes/` | –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—Ñ–∏–ª–µ–π –∏–∑ connections.json |
| `ConnectionManager` | `src/code/infrastructure/classes/` | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è–º–∏ –∫ –ë–î |
| `ConnectionDiagnostics` | `src/code/infrastructure/classes/` | –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ë–î |

---

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ ConnectionManager

### –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```python
from src.code.infrastructure.classes import ConnectionManager

# –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é task_id=2
manager = ConnectionManager()

# –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
pg_conn = manager.get_postgres_connection()
ms_conn = manager.get_mssql_connection()

# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ—Ñ–∏–ª–µ
info = manager.get_connection_info()
print(f"Task ID: {info['task_id']}")
print(f"Profile: {info['profile_name']}")

# –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
manager.close_all_connections()
```

### –†–∞–±–æ—Ç–∞ —Å —Ä–∞–∑–Ω—ã–º–∏ –∑–∞–¥–∞—á–∞–º–∏

```python
# –Ø–≤–Ω–æ–µ —É–∫–∞–∑–∞–Ω–∏–µ task_id
manager = ConnectionManager(task_id=1)

# –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –∑–∞–¥–∞—á–∞–º–∏
manager.switch_task(2)
print(f"–¢–µ–∫—É—â–∏–π task_id: {manager.task_id}")
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ —Å–∫—Ä–∏–ø—Ç–∞—Ö

```python
#!/usr/bin/env python3
"""–ü—Ä–∏–º–µ—Ä —Å–∫—Ä–∏–ø—Ç–∞ –º–∏–≥—Ä–∞—Ü–∏–∏"""

from src.code.infrastructure.classes import ConnectionManager

def main():
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è (task_id=2 –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
    manager = ConnectionManager()
    
    try:
        # –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
        pg_conn = manager.get_postgres_connection()
        ms_conn = manager.get_mssql_connection()
        
        # –í–∞—à–∞ –ª–æ–≥–∏–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏
        cursor = pg_conn.cursor()
        cursor.execute("SELECT version()")
        print(cursor.fetchone())
        
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞: {e}")
    finally:
        manager.close_all_connections()

if __name__ == '__main__':
    main()
```

---

## –ü—Ä–∞–≤–∏–ª–∞ –¥–ª—è AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞

### ‚úÖ –†–ê–ó–†–ï–®–ï–ù–û

```python
# 1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ ConnectionManager (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
manager = ConnectionManager()
conn = manager.get_postgres_connection()

# 2. –Ø–≤–Ω–æ–µ —É–∫–∞–∑–∞–Ω–∏–µ task_id
manager = ConnectionManager(task_id=1)

# 3. –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∑–∞–¥–∞—á
manager.switch_task(2)

# 4. –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø—Ä–æ—Ñ–∏–ª–µ
info = manager.get_connection_info()
```

### ‚ùå –ó–ê–ü–†–ï–©–ï–ù–û

```python
# 1. –ü—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL
conn = psycopg2.connect(
    host='localhost',
    port=5432,
    dbname='fish_eye',
    user='postgres',
    password='postgres'
)  # ‚ùå –ù–ï–¢!

# 2. –ü—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ MS SQL Server
conn = pyodbc.connect(
    "DRIVER={ODBC Driver 17 for SQL Server};"
    "SERVER=localhost,1433;"
    "DATABASE=FishEye;"
    "UID=sa;"
    "PWD=password;"
)  # ‚ùå –ù–ï–¢!

# 3. –ñ–µ—Å—Ç–∫–æ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
host = 'localhost'
port = 5432
dbname = 'fish_eye'
conn = psycopg2.connect(host=host, port=port, dbname=dbname)  # ‚ùå –ù–ï–¢!

# 4. –ß—Ç–µ–Ω–∏–µ config.yaml –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
with open('config.yaml') as f:
    config = yaml.safe_load(f)
conn = psycopg2.connect(**config['database']['postgres'])  # ‚ùå –ù–ï–¢!
```

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. **–í–°–ï–ì–î–ê** –∏—Å–ø–æ–ª—å–∑—É–π `ConnectionManager` –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∫ –ë–î
2. **task_id=2** –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–æ –∏–Ω–æ–µ)
3. **–ù–ï –∏—Å–ø–æ–ª—å–∑—É–π** –ø—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã `psycopg2.connect()` –∏–ª–∏ `pyodbc.connect()`
4. **–ù–ï –∏—Å–ø–æ–ª—å–∑—É–π** –∂–µ—Å—Ç–∫–æ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
5. **–ù–ï —á–∏—Ç–∞–π** config.yaml –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

---

## –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞

### –®–∞–≥–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

1. **–ù–∞–π—Ç–∏** –≤—Å–µ –ø—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã `psycopg2.connect()` / `pyodbc.connect()`
2. **–£–¥–∞–ª–∏—Ç—å** –∂–µ—Å—Ç–∫–æ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
3. **–î–æ–±–∞–≤–∏—Ç—å** –∏–º–ø–æ—Ä—Ç `ConnectionManager`
4. **–ó–∞–º–µ–Ω–∏—Ç—å** –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –Ω–∞ `manager.get_*_connection()`
5. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å** —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è task_id=2 –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
6. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å** –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–π –∫–æ–¥

### –ü—Ä–∏–º–µ—Ä —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ ‚Ññ1

**–î–æ (–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û):**
```python
def check_database():
    conn = psycopg2.connect(
        host='localhost',
        port=5432,
        dbname='fish_eye',
        user='postgres',
        password='postgres'
    )
    cursor = conn.cursor()
    cursor.execute("SELECT COUNT(*) FROM mcl.mssql_tables")
    count = cursor.fetchone()[0]
    conn.close()
    return count
```

**–ü–æ—Å–ª–µ (–ü–†–ê–í–ò–õ–¨–ù–û):**
```python
from src.code.infrastructure.classes import ConnectionManager

def check_database():
    manager = ConnectionManager()  # task_id=2 –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    conn = manager.get_postgres_connection()
    
    try:
        cursor = conn.cursor()
        cursor.execute("SELECT COUNT(*) FROM mcl.mssql_tables")
        count = cursor.fetchone()[0]
        return count
    finally:
        manager.close_all_connections()
```

### –ü—Ä–∏–º–µ—Ä —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ ‚Ññ2

**–î–æ (–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û):**
```python
def migrate_table(table_name):
    # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ MS SQL
    ms_conn = pyodbc.connect(
        "DRIVER={ODBC Driver 17 for SQL Server};"
        "SERVER=localhost,1433;"
        "DATABASE=FishEye;"
        "UID=sa;PWD=password;"
    )
    
    # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL
    pg_conn = psycopg2.connect(
        host='localhost',
        dbname='fish_eye',
        user='postgres',
        password='postgres'
    )
    
    # –ú–∏–≥—Ä–∞—Ü–∏—è...
    ms_conn.close()
    pg_conn.close()
```

**–ü–æ—Å–ª–µ (–ü–†–ê–í–ò–õ–¨–ù–û):**
```python
from src.code.infrastructure.classes import ConnectionManager

def migrate_table(table_name, task_id=2):
    manager = ConnectionManager(task_id=task_id)
    
    try:
        ms_conn = manager.get_mssql_connection()
        pg_conn = manager.get_postgres_connection()
        
        # –ú–∏–≥—Ä–∞—Ü–∏—è —Ç–∞–±–ª–∏—Ü—ã...
        
    finally:
        manager.close_all_connections()
```

---

## –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ ConnectionDiagnostics

```python
from src.code.infrastructure.classes import (
    ConnectionManager,
    ConnectionDiagnostics
)

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
manager = ConnectionManager()
diagnostics = ConnectionDiagnostics(manager)

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è PostgreSQL
pg_report = diagnostics.check_postgres_health()
if pg_report['status'] == 'healthy':
    print("‚úÖ PostgreSQL –¥–æ—Å—Ç—É–ø–µ–Ω")
    print(f"–í–µ—Ä—Å–∏—è: {pg_report['version']}")

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è MS SQL Server
ms_report = diagnostics.check_mssql_health()

# –ü–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏
full_report = diagnostics.generate_health_report()

# –ö—Ä–∞—Å–∏–≤—ã–π –≤—ã–≤–æ–¥ –æ—Ç—á–µ—Ç–∞
diagnostics.print_diagnostic_report()
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ö–µ–º—ã mcl

```python
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Å—Ö–µ–º—ã
if diagnostics.check_schema_exists('mcl', 'postgres'):
    print("‚úÖ –°—Ö–µ–º–∞ mcl —Å—É—â–µ—Å—Ç–≤—É–µ—Ç")
    
    # –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å—Ö–µ–º–µ
    schema_info = diagnostics.get_schema_info('mcl', 'postgres')
    print(f"–¢–∞–±–ª–∏—Ü –≤ —Å—Ö–µ–º–µ: {schema_info['tables_count']}")

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∞–±–ª–∏—Ü –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
metadata_check = diagnostics.check_migration_metadata()
print(f"MS SQL —Ç–∞–±–ª–∏—Ü: {metadata_check['mssql_tables_count']}")
print(f"PostgreSQL —Ç–∞–±–ª–∏—Ü: {metadata_check['postgres_tables_count']}")
```

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ connections.json

### –§–æ—Ä–º–∞—Ç –ø—Ä–æ—Ñ–∏–ª—è

```json
{
  "metadata": {
    "version": "1.0.0",
    "created": "2025-10-07",
    "description": "–ü—Ä–æ—Ñ–∏–ª–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î"
  },
  "profiles": [
    {
      "profile_id": "test_task_2",
      "name": "Test Migration Task 2",
      "task_id": 2,
      "description": "–û—Å–Ω–æ–≤–Ω–∞—è —Ç–µ—Å—Ç–æ–≤–∞—è –∑–∞–¥–∞—á–∞ –º–∏–≥—Ä–∞—Ü–∏–∏",
      "source": {
        "type": "mssql",
        "host": "localhost",
        "port": 1433,
        "database": "FishEye",
        "user": "sa",
        "password": "***",
        "driver": "ODBC Driver 17 for SQL Server",
        "options": {
          "TrustServerCertificate": "yes",
          "ConnectionTimeout": "30",
          "CommandTimeout": "300"
        }
      },
      "target": {
        "type": "postgresql",
        "host": "localhost",
        "port": 5432,
        "database": "fish_eye",
        "user": "postgres",
        "password": "***",
        "ssl": "prefer",
        "options": {
          "connect_timeout": "30",
          "command_timeout": "300"
        }
      },
      "active": true,
      "created": "2025-10-07",
      "last_used": null
    }
  ],
  "default_profile": "test_task_2"
}
```

### –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è

1. **–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å** —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø—Ä–æ—Ñ–∏–ª—å
2. **–ò–∑–º–µ–Ω–∏—Ç—å** `profile_id` –∏ `task_id`
3. **–û–±–Ω–æ–≤–∏—Ç—å** –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π (host, database, user, password)
4. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å** `active: true` –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
5. **–û–±–Ω–æ–≤–∏—Ç—å** `default_profile` –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

### –í–∞–∂–Ω—ã–µ –ø–æ–ª—è

| –ü–æ–ª–µ | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-------------|----------|
| `profile_id` | –î–∞ | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ—Ñ–∏–ª—è |
| `task_id` | –î–∞ | ID –∑–∞–¥–∞—á–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 2) |
| `name` | –î–∞ | –ß–∏—Ç–∞–µ–º–æ–µ –∏–º—è –ø—Ä–æ—Ñ–∏–ª—è |
| `source` | –î–∞ | –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ MS SQL Server |
| `target` | –î–∞ | –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL |
| `active` | –ù–µ—Ç | –ê–∫—Ç–∏–≤–µ–Ω –ª–∏ –ø—Ä–æ—Ñ–∏–ª—å (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é true) |
| `default_profile` | –î–∞ | ID –ø—Ä–æ—Ñ–∏–ª—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é |

---

## –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã

### üîß –†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

```python
# –í —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è connections.json
# –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é task_id=2
from src.code.infrastructure.classes import ConnectionManager

manager = ConnectionManager()  # –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ task_id=2
conn = manager.get_postgres_connection()

# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏
info = manager.get_connection_info()
print(f"–†–µ–∂–∏–º: –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞")
print(f"Task ID: {info['task_id']}")
print(f"–ü—Ä–æ—Ñ–∏–ª—å: {info['profile_name']}")
```

### üöÄ –†–µ–∂–∏–º —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏

```python
# –í —Ä–µ–∂–∏–º–µ —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏ —Ç–∞–∫–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è connections.json
# task_id –º–æ–∂–µ—Ç –±—ã—Ç—å —É–∫–∞–∑–∞–Ω —è–≤–Ω–æ –∏–ª–∏ –≤–∑—è—Ç –∏–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –º–∏–≥—Ä–∞—Ü–∏–∏
from src.code.infrastructure.classes import ConnectionManager

# –Ø–≤–Ω–æ–µ —É–∫–∞–∑–∞–Ω–∏–µ task_id –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω –º–∏–≥—Ä–∞—Ü–∏–∏
manager = ConnectionManager(task_id=production_task_id)
conn = manager.get_postgres_connection()

# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏
info = manager.get_connection_info()
print(f"–†–µ–∂–∏–º: –≠–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—è")
print(f"Task ID: {info['task_id']}")
print(f"–ü—Ä–æ—Ñ–∏–ª—å: {info['profile_name']}")
```

### –í—ã–≤–æ–¥

**–û–±–∞ —Ä–µ–∂–∏–º–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –º–µ—Ö–∞–Ω–∏–∑–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π!**

–†–∞–∑–Ω–∏—Ü–∞ —Ç–æ–ª—å–∫–æ –≤ —Ç–æ–º, –∫–∞–∫ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è task_id:
- **–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞:** task_id=2 –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- **–≠–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—è:** task_id —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —è–≤–Ω–æ –∏–ª–∏ –±–µ—Ä–µ—Ç—Å—è –∏–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

---

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –•—Ä–∞–Ω–µ–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π

‚ö†Ô∏è **–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:**

```bash
# –ù–ï –∫–æ–º–º–∏—Ç—å—Ç–µ connections.json –≤ Git!
# –≠—Ç–æ—Ç —Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–∞—Ä–æ–ª–∏ –∫ –ë–î
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ .gitignore

```gitignore
# –ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
src/code/infrastructure/config/connections.json
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ example-—Ñ–∞–π–ª–æ–≤

1. –°–æ–∑–¥–∞–π—Ç–µ `connections.example.json` —Å —à–∞–±–ª–æ–Ω–æ–º:

```json
{
  "profiles": [{
    "profile_id": "test_task_1",
    "task_id": 1,
    "source": {
      "password": "–ó–ê–ú–ï–ù–ò–¢–ï_–ú–ï–ù–Ø"
    },
    "target": {
      "password": "–ó–ê–ú–ï–ù–ò–¢–ï_–ú–ï–ù–Ø"
    }
  }]
}
```

2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–æ–ø–∏—Ä—É–µ—Ç –∏ —Å–æ–∑–¥–∞–µ—Ç `connections.json`:
```bash
cp connections.example.json connections.json
# –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç –ø–∞—Ä–æ–ª–∏ –≤ connections.json
```

3. `connections.json` –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è Git'–æ–º

---

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –ë–∞–∑–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞

```python
from src.code.infrastructure.classes import ConnectionManager
import psycopg2
import pyodbc

try:
    manager = ConnectionManager(task_id=2)
    conn = manager.get_postgres_connection()
    
    # –í–∞—à –∫–æ–¥...
    
except ValueError as e:
    print(f"‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è: {e}")
    print("–ü—Ä–æ–≤–µ—Ä—å—Ç–µ connections.json –∏ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—Ä–æ—Ñ–∏–ª—å –¥–ª—è task_id=2 —Å—É—â–µ—Å—Ç–≤—É–µ—Ç")
    
except psycopg2.OperationalError as e:
    print(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL: {e}")
    print("–ü—Ä–æ–≤–µ—Ä—å—Ç–µ: PostgreSQL –∑–∞–ø—É—â–µ–Ω? –í–µ—Ä–Ω—ã–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ?")
    
except pyodbc.Error as e:
    print(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ MS SQL Server: {e}")
    print("–ü—Ä–æ–≤–µ—Ä—å—Ç–µ: MS SQL Server –∑–∞–ø—É—â–µ–Ω? –í–µ—Ä–Ω—ã–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ?")
    
finally:
    if 'manager' in locals():
        manager.close_all_connections()
```

### –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å retry

```python
import time
from src.code.infrastructure.classes import ConnectionManager

def get_connection_with_retry(max_retries=3, delay=5):
    """–ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —Å –ø–æ–≤—Ç–æ—Ä–Ω—ã–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏"""
    for attempt in range(max_retries):
        try:
            manager = ConnectionManager()
            conn = manager.get_postgres_connection()
            return manager, conn
        except Exception as e:
            print(f"–ü–æ–ø—ã—Ç–∫–∞ {attempt + 1}/{max_retries} –Ω–µ —É–¥–∞–ª–∞—Å—å: {e}")
            if attempt < max_retries - 1:
                print(f"–û–∂–∏–¥–∞–Ω–∏–µ {delay} —Å–µ–∫—É–Ω–¥ –ø–µ—Ä–µ–¥ —Å–ª–µ–¥—É—é—â–µ–π –ø–æ–ø—ã—Ç–∫–æ–π...")
                time.sleep(delay)
    raise ConnectionError(f"–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –ø–æ—Å–ª–µ {max_retries} –ø–æ–ø—ã—Ç–æ–∫")
```

---

## –ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã

### –ö–∞–∫ —É–∑–Ω–∞—Ç—å —Ç–µ–∫—É—â–∏–π task_id?

```python
manager = ConnectionManager()
print(f"–¢–µ–∫—É—â–∏–π task_id: {manager.task_id}")  # –í—ã–≤–µ–¥–µ—Ç: 2
```

### –ö–∞–∫ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ –¥—Ä—É–≥—É—é –∑–∞–¥–∞—á—É –º–∏–≥—Ä–∞—Ü–∏–∏?

```python
manager = ConnectionManager()  # task_id=2
# ... —Ä–∞–±–æ—Ç–∞ —Å task_id=2

manager.switch_task(1)  # –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ task_id=1
# ... —Ä–∞–±–æ—Ç–∞ —Å task_id=1
```

### –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ë–î?

```python
from src.code.infrastructure.classes import ConnectionManager, ConnectionDiagnostics

manager = ConnectionManager()
diagnostics = ConnectionDiagnostics(manager)

# –ü—Ä–æ–≤–µ—Ä–∫–∞ PostgreSQL
pg_check = diagnostics.test_postgres_connection()
if pg_check['status'] == 'success':
    print("‚úÖ PostgreSQL –¥–æ—Å—Ç—É–ø–µ–Ω!")
else:
    print(f"‚ùå PostgreSQL –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω: {pg_check['error']}")
```

### –ì–¥–µ –≤–∑—è—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è?

1. –û—Ç–∫—Ä–æ–π—Ç–µ `src/code/infrastructure/config/connections.example.json`
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ—Ñ–∏–ª—è
3. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –ø—Ä–æ—Ñ–∏–ª—å –≤ `connections.json`
4. –£–∫–∞–∂–∏—Ç–µ —Å–≤–æ–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

### –ú–æ–∂–Ω–æ –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ—Ñ–∏–ª–µ–π –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ?

–î–∞! –°–æ–∑–¥–∞–π—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤:

```python
manager1 = ConnectionManager(task_id=1)
manager2 = ConnectionManager(task_id=2)

conn1 = manager1.get_postgres_connection()
conn2 = manager2.get_postgres_connection()
```

### –ö–∞–∫ —É–∑–Ω–∞—Ç—å, –∫–∞–∫–∏–µ –ø—Ä–æ—Ñ–∏–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã?

```python
from src.code.infrastructure.classes import ConnectionProfileLoader

loader = ConnectionProfileLoader()
profiles = loader.list_profiles()

for profile in profiles:
    print(f"Task ID: {profile['task_id']}")
    print(f"Name: {profile['name']}")
    print(f"Active: {profile['active']}")
    print("---")
```

### –ß—Ç–æ –¥–µ–ª–∞—Ç—å –µ—Å–ª–∏ –∑–∞–±—ã–ª task_id?

```python
manager = ConnectionManager()  # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é task_id=2
info = manager.get_connection_info()
print(f"–í—ã —Ä–∞–±–æ—Ç–∞–µ—Ç–µ —Å task_id: {info['task_id']}")
```

---

## –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã

- **–û–±—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞ –ø—Ä–æ–µ–∫—Ç–∞:** `docs/project-documentation-rules.md`
- **–û–ø–∏—Å–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤:** `src/code/infrastructure/config/README.md`
- **–ö—É—Ä—Å–æ—Ä –ø—Ä–∞–≤–∏–ª–∞:** `.cursorrules` (–∫—Ä–∞—Ç–∫–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ —ç—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç)

---

**–î–æ–∫—É–º–µ–Ω—Ç —É—Ç–≤–µ—Ä–∂–¥–µ–Ω:** 2025-10-07  
**–°–ª–µ–¥—É—é—â–∏–π –ø–µ—Ä–µ—Å–º–æ—Ç—Ä:** 2026-01-07  
**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π:** –ê–ª–µ–∫—Å–∞–Ω–¥—Ä  
**–°—Ç–∞—Ç—É—Å:** –î–µ–π—Å—Ç–≤—É—é—â–∏–π
