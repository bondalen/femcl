# Правила ведения проектной документации FEMCL

**Версия:** 1.0.0  
**Дата создания:** 2025-08-25  
**Последнее обновление:** 2025-10-07  
**Автор:** Александр  

## Обзор

Данный документ описывает структуру, правила и порядок ведения проектной документации для универсальной системы миграции баз данных FEMCL (Fish Eye Migration Control Layer). Система предназначена для многократного использования при миграции различных баз данных из MS SQL Server в PostgreSQL с использованием AI и набора скриптов.

## Структура документации

### 1. **project-docs.json** - Проектная документация
**Назначение:** Центральный файл с описанием архитектуры, технологий, модулей и конфигурации проекта.

**Содержание:**
- Метаданные проекта
- Архитектурные решения
- Технологический стек
- Модули и их описание
- Схема базы данных
- Конфигурация развертывания
- Временные рамки и риски
- Ресурсы и команда
- Объекты разработки (включая правила AI)

**Правила ведения:**
- Обновляется при изменении архитектуры
- Содержит ссылки на ADR (Architectural Decision Records)
- Включает ссылки на задачи разработки
- Версионируется при значительных изменениях

### 2. **project-development.json** - Планирование разработки
**Назначение:** Файл планирования разработки в виде иерархической структуры задач с возможностью сворачивания ветвей.

**Содержание:**
- Метаданные разработки
- Иерархическая структура задач
- Система нумерации с буквами
- Зависимости между задачами
- Ссылки на элементы проектной документации
- Ссылки на записи дневника разработки
- Вехи и ресурсы
- Задачи разработки правил AI

**Правила ведения:**
- Задачи имеют бесконечную вложенность
- Используется расширенная система нумерации (01-99, 0a-0z, 1a-1z, ..., a0-zz)
- Каждая задача ссылается на элементы project-docs.json
- Обновляется при изменении планов разработки
- Содержит ссылки на записи project-journal.json
- Включает задачи разработки правил AI как объектов разработки

### 3. **project-journal.json** - Дневник разработки
**Назначение:** Дневник разработки с детальным описанием выполненных работ, изменений и состояний.

**Содержание:**
- Метаданные дневника
- Записи о выполненных работах
- Исходное и итоговое состояние объектов
- Ссылки на задачи разработки
- Ссылки на элементы проектной документации
- Временные метки и контекст
- Записи разработки правил AI

**Правила ведения:**
- Создается запись для каждого значимого изменения
- Содержит детальное описание изменений
- Включает ссылки на задачи и элементы проекта
- Ведется в хронологическом порядке
- Содержит метаданные о времени, сложности, тегах
- **Структура:** Использует иерархическую структуру с уровнями `chat-attributes` и `log-attributes`
- **Навигация:** Каждый чат и лог имеет `displayName` для удобной навигации
- **Группировка:** Простые свойства группируются в `*-attributes`, сложные объекты в `entries`
- Включает записи разработки правил AI как объектов разработки

## Объекты разработки

### Кодовая база проекта
- **src/classes/** - Классы системы миграции
- **src/scripts/** - Скрипты миграции
- **src/config/** - Конфигурация системы

### Правила работы AI при миграции БД
- **src/ai-rules/** - Правила для AI (объект разработки)
  - **ai-rules.json** - Основной файл правил AI
  - **migration/** - Правила миграции
  - **analysis/** - Правила анализа БД
  - **transformation/** - Правила преобразования
  - **validation/** - Правила валидации

## Работа с правилами AI в период разработки

### Правила AI как объект разработки
- **Создание правил** - разработка новых правил для AI
- **Тестирование правил** - проверка эффективности правил
- **Итеративное улучшение** - доработка правил на основе опыта
- **Валидация правил** - проверка корректности правил
- **Документирование правил** - описание логики правил

### Процесс разработки правил AI
1. **Анализ требований** - определение нужных правил
2. **Создание правил** - написание правил в JSON/Markdown
3. **Тестирование** - проверка правил на тестовых данных
4. **Итерация** - улучшение правил на основе результатов
5. **Документирование** - описание правил в технической документации

## Процесс добавления новых артефактов

### Обязательный чеклист при создании нового артефакта

#### При создании нового класса Python:
1. **Создать файл класса** в соответствующей директории (например, `src/code/infrastructure/classes/`)
2. **Добавить в project-docs.json:**
   - Найти соответствующий модуль в `project.architecture.modules.list[N]`
   - Если нужен новый компонент - создать его
   - Добавить класс в массив `classes` компонента
   - Указать: `id`, `name`, `location`, `responsibilities`, `dependsOn`, `status`
3. **Создать задачу в project-development.json:**
   - Добавить задачу разработки класса с ID, приоритетом, оценкой
   - Указать ссылку на элемент в `projectDocsRefs`
4. **Добавить запись в project-journal.json:**
   - Создать лог о начале работы над классом
   - Указать ссылки на задачу и элемент проекта
5. **Обновить зависимости:**
   - Если класс используется в других местах - добавить в `dependsOn`
   - Если класс упоминается в стадиях - добавить ссылку на него в атрибуте `class`

#### При создании файла конфигурации:
1. **Создать файл** в `src/code/infrastructure/config/`
2. **Добавить в project-docs.json:**
   - Найти компонент `config` в модуле `infrastructure`
   - Добавить имя файла в массив `files`
   - Если файл не должен коммититься в Git - добавить примечание в `notes`
3. **Обновить .gitignore** (если нужно)
4. **Создать .example файл** (для файлов с конфиденциальными данными)
5. **Добавить в документацию:**
   - Описать назначение файла
   - Привести пример структуры

#### При создании стадии миграции:
1. **Добавить стадию в project-docs.json:**
   - Вставить в массив `project.architecture.stages.rootStages`
   - Указать: `displayName`, `id`, `description`, `predecessors`, `validationCriteria`
   - Добавить подстадии (`substages`) с детальным алгоритмом
   - Указать используемые классы в атрибуте `class`
2. **НЕ дублировать в AI-правилах:**
   - AI-правила только ссылаются на стадии
   - Алгоритм только в project-docs.json
3. **Создать задачу документирования стадии** в project-development.json

#### При создании правила AI:
1. **Создать файл правила** в `src/ai-rules/[category]/`
2. **Добавить в project-docs.json:**
   - Раздел `project.rules.aiRules.categories.[category]`
   - Указать файл в массиве `files` категории
3. **Создать задачу разработки** в project-development.json с `aiRuleRefs`
4. **НЕ дублировать алгоритм:** правила ссылаются на стадии, а не описывают их

### Принцип разделения ответственности артефактов

| Тип артефакта | Где хранится | Где описывается | Назначение |
|---------------|--------------|-----------------|------------|
| Класс Python | `src/code/` | `project.architecture.modules` | Реализация логики |
| Файл конфигурации | `src/code/infrastructure/config/` | `project.architecture.modules[].components[].files` | Настройки |
| Стадия миграции | N/A | `project.architecture.stages` | Алгоритм работы |
| Правило AI | `src/ai-rules/` | `project.rules.aiRules` | Ссылки на стадии |
| Задача разработки | N/A | `project-development.json` | Планирование |
| Запись журнала | N/A | `project-journal.json` | История изменений |

### Контроль целостности ссылок

При добавлении артефакта **ОБЯЗАТЕЛЬНО** проверить:
- ✅ Есть ли описание в разделе модулей `project-docs.json`
- ✅ Есть ли задача разработки в `project-development.json`
- ✅ Есть ли запись в журнале `project-journal.json`
- ✅ Корректны ли все ссылки (`projectDocsRefs`, `aiRuleRefs`, `journalRefs`)
- ✅ Указаны ли зависимости (`dependsOn`, `predecessors`)
- ✅ Обновлен ли статус (`status`: planned/in-progress/implemented)

## Система нумерации задач

### Расширенная система нумерации
- **01-99** - цифровые задачи
- **0a-0z** - буквенные задачи (первая цифра 0)
- **1a-1z** - буквенные задачи (первая цифра 1)
- **...**
- **9a-9z** - буквенные задачи (первая цифра 9)
- **a0-a9** - буквенные задачи (первая буква a)
- **aa-az** - буквенные задачи (первая буква a)
- **b0-b9** - буквенные задачи (первая буква b)
- **ba-bz** - буквенные задачи (первая буква b)
- **...**
- **z0-z9** - буквенные задачи (первая буква z)
- **za-zz** - буквенные задачи (первая буква z)

### Емкость системы
- **Цифры:** 01-99 = 99 задач
- **Буквы после цифр:** 0a-0z, 1a-1z, ..., 9a-9z = 10 × 26 = 260 задач
- **Буквы перед цифрами:** a0-a9, b0-b9, ..., z0-z9 = 26 × 10 = 260 задач
- **Буквы перед буквами:** aa-az, ba-bz, ..., za-zz = 26 × 26 = 676 задач
- **Итого:** 99 + 260 + 260 + 676 = **1,295 задач на уровень**

### Примеры нумерации
```
01 - Разработка системы миграции
├── 01.01 - Создание классов системы
│   ├── 01.01.01 - TableModel класс
│   ├── 01.01.02 - TableMigrator класс
│   └── 01.01.0a - ColumnModel класс
├── 01.02 - Разработка правил AI
│   ├── 01.02.01 - Правила миграции
│   ├── 01.02.02 - Правила анализа
│   └── 01.02.0a - Правила валидации
└── 01.03 - Создание скриптов

0a - Документация
├── 0a.01 - ADR документация
└── 0a.0a - Техническая документация

a0 - Тестирование
└── a0.01 - Тестирование правил AI

aa - Оптимизация
└── aa.01 - Оптимизация алгоритмов
```

## Связи между файлами

### 1. **project-docs.json** → **project-development.json**
```json
{
  "project": {
    "development-objects": {
      "ai-rules": {
        "location": "src/ai-rules/",
        "development_status": "in-development",
        "development_tasks": ["01.02", "01.02.01", "01.02.02"]
      }
    }
  }
}
```

### 2. **project-development.json** → **project-journal.json**
```json
{
  "tasks": [
    {
      "id": "01.02.01",
      "object-type": "ai-rules",
      "object-location": "src/ai-rules/migration/",
      "developmentLogs": [
        "log-2025-01-27-001",
        "log-2025-01-27-002"
      ]
    }
  ]
}
```

### 3. **project-journal.json** → **project-docs.json**
```json
{
  "entries": [
    {
      "id": "log-2025-01-27-001",
      "object-type": "ai-rules",
      "object-location": "src/ai-rules/migration/table-migration.md",
      "projectElement": "project.development-objects.ai-rules"
    }
  ]
}
```

## Правила обновления

### Обязательные требования
- **Перед любыми корректировками документации** - обязательно изучить и учесть правила ведения документации
- **Перед созданием записей в журнале** - обязательно запросить имя чата у пользователя с предложением вариантов
- **При изменении структуры** - обновить соответствующие правила и связанные файлы

### Обновление project-docs.json
- При изменении архитектуры
- При добавлении новых модулей
- При изменении технологического стека
- При обновлении конфигурации развертывания
- При изменении временных рамок
- При разработке правил AI
- **При создании новых артефактов (классов, файлов конфигурации):**
  - **ОБЯЗАТЕЛЬНО** добавить в раздел `project.architecture.modules.list[N].components`
  - Указать тип компонента, ответственность, статус
  - Добавить классы в соответствующий компонент
  - Указать зависимости (`dependsOn`)
  - Для файлов конфигурации: добавить в список `files` компонента
  - Добавить ссылки из других разделов (stages, developmentObjects)
  - Пример: новый класс `MigrationMetrics` → добавить компонент `migrationMetrics` в модуль `infrastructure`

### Обновление project-development.json
- **Структура задач** - каждая задача должна отображаться одной строкой с возможностью развертывания
- **Навигация** - обеспечить возможность навигации по иерархии задач
- **Иерархическая структура** - использовать уровни `task-attributes` для группировки простых свойств
- **Объектная структура** - `task` должен быть объектом с полями `displayName`, `task-attributes`, `non-subtasks` и `subtasks`
- **ID в displayName** - обязательно включать ID в формате `[Эмодзи] [Название] ([статус], [время], [приоритет]). № [ID]`
- **Разделение содержимого** - `non-subtasks` для сложных объектов, `subtasks` для подзадач
- **Читаемость** - обеспечить понятные заголовки при свертывании разделов
- **Расширенные описания** - использовать `extendedDescriptions` для ссылок на детальные описания в текстовых файлах
- При планировании новых задач
- При изменении приоритетов
- При добавлении зависимостей
- При изменении временных рамок
- При пересмотре планов разработки
- При разработке правил AI

### Обновление project-journal.json
- **Перед созданием записей** - обязательно запросить имя чата у пользователя с предложением вариантов
- **Структура чатов** - каждый чат должен отображаться одной строкой с возможностью развертывания
- **Навигация** - обеспечить возможность навигации по чатам журнала
- **Иерархическая структура** - использовать уровни `chat-attributes` и `log-attributes` для группировки простых свойств
- **Объектная структура** - `chat` и `log` должны быть объектами с полями `displayName` и `entries`
- **Расширенные описания** - использовать `extendedDescriptions` для ссылок на детальные описания действий в текстовых файлах
- После выполнения каждой задачи
- При изменении состояния объектов
- При создании новых артефактов
- При решении проблем
- При изменении подходов
- При разработке правил AI

## Стандарты ведения

### Формат дат
- **ISO 8601:** YYYY-MM-DDTHH:mm:ssZ
- **Пример:** 2025-01-27T10:30:00Z

### Формат ID
- **Задачи:** 01.01.01.01 (иерархическая нумерация)
- **Записи дневника:** log-YYYY-MM-DD-NNN
- **Элементы проекта:** project.architecture.backend.framework
- **Объекты разработки:** project.development-objects.ai-rules

### Статусы задач
- **pending** - запланировано
- **in-progress** - в работе
- **completed** - завершено
- **blocked** - заблокировано
- **cancelled** - отменено

### Приоритеты
- **critical** - критический
- **high** - высокий
- **medium** - средний
- **low** - низкий

### Типы объектов разработки
- **codebase** - кодовая база
- **ai-rules** - правила AI
- **documentation** - документация
- **configuration** - конфигурация

## Структура файлов документации

### Организация папок
```
docs/
├── project-documentation-rules.md  # Правила ведения документации
├── project/                        # Документация проекта
│   ├── project-docs.json          # Основной файл проекта
│   ├── architecture/              # Архитектурная документация
│   ├── decisions/                 # ADR решения
│   └── technical/                 # Техническая документация
├── development/                    # Документация разработки
│   ├── project-development.json   # Файл задач разработки
│   ├── tasks/                     # Описания задач
│   ├── technical/                 # Технические детали
│   └── notes/                     # Заметки по реализации
└── journal/                       # Журнал разработки
    ├── project-journal.json       # Файл журнала
    ├── actions/                   # Описания действий
    ├── technical/                 # Технические детали
    ├── notes/                     # Заметки по реализации
    └── troubleshooting/           # Решение проблем
```

### Принципы организации
- **Модульность** - каждый тип документации в своей папке
- **Самодостаточность** - каждая папка содержит все необходимые файлы
- **Навигация** - понятная структура для быстрого поиска
- **Расширяемость** - легко добавлять новые типы документации

## Инструменты и автоматизация

### Рекомендуемые инструменты
- **JSON Editor** - для редактирования JSON файлов
- **Git** - для версионирования изменений
- **Markdown Editor** - для ADR документации
- **Task Tracker** - для отслеживания прогресса

### Автоматизация
- **Валидация JSON** - проверка корректности структуры
- **Синхронизация ссылок** - проверка целостности связей
- **Генерация отчетов** - автоматическое создание отчетов
- **Уведомления** - оповещения об изменениях

## Контроль качества

### Проверки
- **Структурная целостность** - корректность JSON структуры
- **Ссылочная целостность** - существование всех ссылок
- **Временная согласованность** - логичность временных рамок
- **Зависимостная целостность** - корректность зависимостей

### Ревизии
- **Еженедельные** - проверка актуальности документации
- **Ежемесячные** - анализ полноты и качества
- **Квартальные** - пересмотр структуры и правил
- **По требованию** - при значительных изменениях

## Резервное копирование

### Стратегия бэкапов
- **Ежедневные** - автоматические бэкапы в Git
- **Еженедельные** - полные копии файлов
- **Перед изменениями** - создание снимков состояния
- **Внешние** - копирование в облачные хранилища

### Восстановление
- **Из Git** - восстановление из истории версий
- **Из бэкапов** - восстановление из резервных копий
- **Частичное** - восстановление отдельных разделов
- **Полное** - восстановление всей документации

## Правила для AI-ассистента Cursor

### Режимы работы AI-ассистента
- **🔧 РЕЖИМ РАЗРАБОТКИ** - разработка системы, создание правил AI, ведение документации
- **🚀 РЕЖИМ ЭКСПЛУАТАЦИИ** - перенос БД с использованием готовых правил AI

### Обязательные требования для AI-ассистента
- **ОБЯЗАТЕЛЬНО уточнять режим работы** в начале каждого чата
- **Использовать Desktop Commander** для всех файловых операций
- **Запрашивать разрешение** перед выполнением терминальных команд
- **Следовать правилам** из этого документа
- **НЕ дублировать** правила из этого файла

### Контекстные правила для AI-ассистента

#### В режиме разработки:
- Создавай правила AI как объекты разработки в src/ai-rules/
- Тестируй правила на тестовых данных
- Итеративно улучшай правила
- Документируй процесс разработки правил
- Следуй структуре документации из этого файла

#### В режиме эксплуатации:
- Используй готовые правила AI из src/ai-rules/
- НЕ изменяй правила AI, только применяй их
- Следуй алгоритмам из ai-rules.json
- Применяй правила миграции, анализа, преобразования, валидации

#### При работе с файловой системой:
- **ОБЯЗАТЕЛЬНО используй Desktop Commander** для всех операций с файлами
- **НЕ используй** стандартные инструменты чтения/записи файлов
- **Используй Desktop Commander** для:
  - Чтения файлов (mcp_desktop-commander_read_file)
  - Записи файлов (mcp_desktop-commander_write_file)
  - Создания папок (mcp_desktop-commander_create_directory)
  - Перемещения файлов (mcp_desktop-commander_move_file)
  - Поиска файлов (mcp_desktop-commander_start_search)
  - Редактирования файлов (mcp_desktop-commander_edit_block)

#### При работе с терминалом:
- **ОБЯЗАТЕЛЬНО запрашивай разрешение** перед выполнением команд
- **Используй Desktop Commander** для терминальных операций:
  - Запуск процессов (mcp_desktop-commander_start_process)
  - Взаимодействие с процессами (mcp_desktop-commander_interact_with_process)
  - Чтение вывода (mcp_desktop-commander_read_process_output)
- **НЕ выполняй команды** без явного разрешения пользователя
- **Объясняй цель команды** перед запросом разрешения

#### При работе с базами данных:
- **ОБЯЗАТЕЛЬНО используй ConnectionManager** для всех подключений к БД
- **Источник подключений:** `src/code/infrastructure/config/connections.json` (task_id=2 по умолчанию)
- **ДЕТАЛЬНЫЕ ПРАВИЛА:** См. `docs/infrastructure/database-connections-rules.md`
- **НЕ используй** прямые подключения (`psycopg2.connect()`, `pyodbc.connect()`)
- **НЕ используй** жестко закодированные параметры подключения
- **Объясняй цель** каждой операции с БД

#### При работе с системными операциями:
- **ВСЕГДА используй Desktop Commander** вместо стандартных инструментов
- **Запрашивай разрешение** перед выполнением системных команд
- **Объясняй необходимость** каждой команды
- **Используй безопасные методы** через Desktop Commander API

## Заключение

Данная система документации обеспечивает:
- **Полноту** - охват всех аспектов проекта
- **Структурированность** - четкая организация информации
- **Трассируемость** - возможность отслеживания изменений
- **Масштабируемость** - возможность расширения системы
- **Удобство использования** - простота навигации и поиска
- **Поддержку разработки правил AI** - как объектов разработки
- **Правила для AI-ассистента** - четкие инструкции для работы с Cursor IDE

Соблюдение данных правил гарантирует качество и актуальность проектной документации на всех этапах разработки универсальной системы миграции баз данных FEMCL.

---

**Документ утвержден:** 2025-10-06  
**Следующий пересмотр:** 2026-01-06  
**Ответственный:** Александр