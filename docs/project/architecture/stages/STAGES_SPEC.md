# Спецификация раздела Stages

## Назначение
Подробное описание операционного процесса миграции БД в виде иерархических стадий. Раздел описывает процесс работы по переносу базы данных при эксплуатации системы FEMCL.

## Схема данных stage

### Структура объекта stage
```json
{
  "displayName": "Название стадии. № ID",
  "attributes": {
    "id": "строка (иерархическая нумерация)",
    "description": "описание процесса",
    "predecessors": ["массив ID предшествующих стадий"],
    "validationCriteria": "критерии успешного выполнения"
  },
  "substages": ["массив дочерних stage"]
}
```

### Правила заполнения

#### ID (идентификатор)
- **Формат**: иерархическая нумерация (01, 01.01, 01.01.01, 01.01.01.01...)
- **Максимум на уровне**: 99 элементов
- **Структурный характер**: отражает вложенность и порядок выполнения

#### displayName
- **Формат**: "Название стадии. № ID"
- **Назначение**: краткое описание для навигации в свернутом виде
- **Пример**: "Подготовка к миграции. № 01"

#### attributes
- **id**: уникальный идентификатор стадии
- **description**: подробное описание процесса
- **predecessors**: массив ID стадий, которые должны быть выполнены перед текущей
- **validationCriteria**: критерии успешного выполнения стадии

#### substages
- Массив дочерних стадий
- Поддерживает бесконечную вложенность
- Каждая дочерняя стадия имеет ту же структуру

## Правила разработки

### Нумерация
- Строго структурная: 01, 01.01, 01.01.01, 01.01.01.01...
- НЕ использовать: 01a, 01b, 01.1a и т.п.
- Каждый уровень: 01-99

### Атрибуты
- **НЕ включать**: status, priority, estimatedDuration (не применимо для эксплуатации)
- **Обязательно**: id, description, validationCriteria
- **Опционально**: predecessors (если есть зависимости)

### displayName
- Только название и номер: "Название. № ID"
- НЕ включать: статус, время, приоритет

## Связи между стадиями

### predecessors
- Указывает стадии, которые должны быть выполнены ПЕРЕД текущей
- Массив ID предшествующих стадий
- Пустой массив [] для начальных стадий

### Иерархия
- Родительские стадии содержат дочерние в substages
- Дочерние стадии наследуют контекст родительских
- Глубина вложенности не ограничена

## Документирование стадий

### Базовый файл спецификации
- `STAGES_SPEC.md` — данный файл с общими правилами

### Детализация по стадиям
- Для сложных стадий: `docs/project/architecture/stages/<ID>/README.md`
- Примеры:
  - `docs/project/architecture/stages/01/README.md` — Подготовка к миграции
  - `docs/project/architecture/stages/02/README.md` — Формирование таблиц
  - `docs/project/architecture/stages/02/02.02/README.md` — Создание объектов

### Структура детальных файлов
```markdown
# Стадия <ID>: <Название>

## Описание
<подробное описание процесса>

## Входные данные
<что требуется для выполнения>

## Процесс выполнения
<пошаговое описание>

## Выходные данные
<что получается в результате>

## Критерии успеха
<критерии из validationCriteria>

## Связанные стадии
- Предшествующие: <список predecessors>
- Последующие: <стадии, которые зависят от текущей>
```

## Примеры

### Простая стадия
```json
{
  "displayName": "Проверка подключений к БД. № 01.01",
  "attributes": {
    "id": "01.01",
    "description": "Тестирование подключений к MS SQL Server и PostgreSQL",
    "validationCriteria": "Успешное подключение к обеим БД"
  },
  "substages": []
}
```

### Сложная стадия с подстадиями
```json
{
  "displayName": "Этап 1: Формирование таблиц и перенос данных. № 02",
  "attributes": {
    "id": "02",
    "description": "Создание структуры таблиц и перенос данных",
    "predecessors": ["01"],
    "validationCriteria": "Все таблицы созданы и данные перенесены"
  },
  "substages": [
    {
      "displayName": "Этап 1.1: Формирование метаданных. № 02.01",
      "attributes": {
        "id": "02.01",
        "description": "Создание метаданных целевой схемы PostgreSQL",
        "validationCriteria": "Метаданные созданы для всех таблиц"
      },
      "substages": []
    }
  ]
}
```

## Обновление документации

### При изменении стадий
1. Обновить структуру в `project-docs.json`
2. При необходимости создать/обновить детальные файлы в `stages/<ID>/`
3. Обновить данный файл спецификации при изменении правил

### Версионирование
- Изменения в структуре стадий отражаются в `metadata.lastUpdated`
- Детальные файлы версионируются отдельно

---

**Создан**: 2025-10-06  
**Версия**: 1.0.0  
**Автор**: Александр