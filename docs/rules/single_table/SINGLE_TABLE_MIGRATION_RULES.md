# üìã –ü–†–ê–í–ò–õ–ê –ü–ï–†–ï–ù–û–°–ê –û–¢–î–ï–õ–¨–ù–û–ô –¢–ê–ë–õ–ò–¶–´

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞
–î–∞–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç —è–≤–ª—è–µ—Ç—Å—è **—Å–∞–º–æ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–º –º–æ–¥—É–ª–µ–º** —Å–∏—Å—Ç–µ–º—ã –ø—Ä–∞–≤–∏–ª –º–∏–≥—Ä–∞—Ü–∏–∏ FEMCL –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –ø–µ—Ä–µ–Ω–æ—Å–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã –∏–∑ MS SQL Server –≤ PostgreSQL.

**‚ö†Ô∏è –í–ê–ñ–ù–û:** –î–∞–Ω–Ω—ã–π —Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é, –Ω–µ–æ–±—Ö–æ–¥–∏–º—É—é –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã. –í–Ω–µ—à–Ω–∏–µ –∑–∞–ø—Ä–æ—Å—ã –¥–æ–ª–∂–Ω—ã —Å—Å—ã–ª–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ —ç—Ç–æ—Ç —Ñ–∞–π–ª.

---

## üéØ –ö–û–ù–¢–ï–ö–°–¢ –ó–ê–î–ê–ß–ò –ú–ò–ì–†–ê–¶–ò–ò

**‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:** –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∑–∞–¥–∞—á–∏ –º–∏–≥—Ä–∞—Ü–∏–∏.

## üîÑ –ü–†–ï–î–í–ê–†–ò–¢–ï–õ–¨–ù–û–ï –†–ê–°–ü–†–ï–î–ï–õ–ï–ù–ò–ï –ö–û–õ–û–ù–û–ö

**‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:** –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–ª–æ–Ω–æ–∫ –º–µ–∂–¥—É –±–∞–∑–æ–≤—ã–º–∏ —Ç–∞–±–ª–∏—Ü–∞–º–∏ –∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è–º–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ —ç—Ç–∞–ø–µ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö, –∞ –Ω–µ –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏.

### –ü—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è:
1. **–û–±—ã—á–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã** (–±–µ–∑ –≤—ã—á–∏—Å–ª—è–µ–º—ã—Ö –∫–æ–ª–æ–Ω–æ–∫):
   - `base_table_name = view_name = –∏—Å—Ö–æ–¥–Ω–æ–µ_–∏–º—è`
   - –í—Å–µ –∫–æ–ª–æ–Ω–∫–∏ –∏–º–µ—é—Ç `target_type = 'both'`

2. **–¢–∞–±–ª–∏—Ü—ã —Å –≤—ã—á–∏—Å–ª—è–µ–º—ã–º–∏ –∫–æ–ª–æ–Ω–∫–∞–º–∏**:
   - `base_table_name = –∏—Å—Ö–æ–¥–Ω–æ–µ_–∏–º—è + '_bt'`
   - `view_name = –∏—Å—Ö–æ–¥–Ω–æ–µ_–∏–º—è`
   - –§–∏–∑–∏—á–µ—Å–∫–∏–µ –∫–æ–ª–æ–Ω–∫–∏: `target_type = 'both'`
   - –í—ã—á–∏—Å–ª—è–µ–º—ã–µ –∫–æ–ª–æ–Ω–∫–∏: `target_type = 'view'`

### –ê–ª–≥–æ—Ä–∏—Ç–º –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è:
```python
def analyze_and_distribute_columns(task_id: int) -> bool:
    """–ê–Ω–∞–ª–∏–∑ –∏ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–ª–æ–Ω–æ–∫ –Ω–∞ —ç—Ç–∞–ø–µ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö"""
    # 1. –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü –∑–∞–¥–∞—á–∏
    # 2. –ê–Ω–∞–ª–∏–∑ –∫–æ–ª–æ–Ω–æ–∫ –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü—ã
    # 3. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–ª–∏—á–∏—è –≤—ã—á–∏—Å–ª—è–µ–º—ã—Ö –ø–æ–ª–µ–π
    # 4. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–º–µ–Ω –æ–±—ä–µ–∫—Ç–æ–≤
    # 5. –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–ª–æ–Ω–æ–∫ –ø–æ –æ–±—ä–µ–∫—Ç–∞–º
    # 6. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö:
```sql
-- –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ postgres_tables
CREATE TABLE mcl.postgres_tables (
    id INTEGER PRIMARY KEY,
    source_table_id INTEGER REFERENCES mcl.mssql_tables(id),
    object_name VARCHAR,           -- –ò—Å—Ö–æ–¥–Ω–æ–µ –∏–º—è
    base_table_name VARCHAR,       -- –ò–º—è –±–∞–∑–æ–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã (–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ –∑–∞—Ä–∞–Ω–µ–µ)
    view_name VARCHAR,             -- –ò–º—è –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è (–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ –∑–∞—Ä–∞–Ω–µ–µ)
    has_computed_columns BOOLEAN,  -- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–æ –∑–∞—Ä–∞–Ω–µ–µ –Ω–∞ —ç—Ç–∞–ø–µ –∞–Ω–∞–ª–∏–∑–∞
    base_table_created BOOLEAN DEFAULT FALSE,
    view_created BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP,
    updated_at TIMESTAMP
);

-- –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ postgres_columns —Å –ü–†–ï–î–í–ê–†–ò–¢–ï–õ–¨–ù–´–ú —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º
CREATE TABLE mcl.postgres_columns (
    id INTEGER PRIMARY KEY,
    table_id INTEGER REFERENCES mcl.postgres_tables(id),
    source_column_id INTEGER REFERENCES mcl.mssql_columns(id),
    column_name VARCHAR,
    ordinal_position INTEGER,
    is_computed BOOLEAN,           -- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–æ –∑–∞—Ä–∞–Ω–µ–µ
    target_type VARCHAR,           -- 'base_table', 'view' –∏–ª–∏ 'both' - –û–ü–†–ï–î–ï–õ–ï–ù–û –ó–ê–†–ê–ù–ï–ï
    base_table_position INTEGER,   -- –ü–æ–∑–∏—Ü–∏—è –≤ –±–∞–∑–æ–≤–æ–π —Ç–∞–±–ª–∏—Ü–µ
    view_position INTEGER,         -- –ü–æ–∑–∏—Ü–∏—è –≤ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–∏
    created_at TIMESTAMP,
    updated_at TIMESTAMP
);
```

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è:
1. ‚úÖ **–ò—Å–∫–ª—é—á–µ–Ω–∏–µ –æ—à–∏–±–æ–∫** –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –º–∏–≥—Ä–∞—Ü–∏–∏
2. ‚úÖ **–ü–æ–ª–Ω–∞—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å** —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–æ–ª–æ–Ω–æ–∫
3. ‚úÖ **–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è** –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
4. ‚úÖ **–ë—ã—Å—Ç—Ä–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ** –º–∏–≥—Ä–∞—Ü–∏–∏ –±–µ–∑ —Å–ª–æ–∂–Ω—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π
5. ‚úÖ **–õ–µ–≥–∫–æ—Å—Ç—å –æ—Ç–ª–∞–¥–∫–∏** –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–æ–∫

---

## üéØ –°–ò–°–¢–ï–ú–ê –ú–ê–ü–ü–ò–ù–ì–ê –§–£–ù–ö–¶–ò–ô

**‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ PostgreSQL –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π —Ñ—É–Ω–∫—Ü–∏–π –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ —ç—Ç–∞–ø–µ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –≤–æ –≤—Ä–µ–º—è –º–∏–≥—Ä–∞—Ü–∏–∏.

### –ü—Ä–∏–Ω—Ü–∏–ø—ã —Å–∏—Å—Ç–µ–º—ã –º–∞–ø–ø–∏–Ω–≥–∞:
1. **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ** - –≤—Å–µ –ø—Ä–∞–≤–∏–ª–∞ –º–∞–ø–ø–∏–Ω–≥–∞ –≤ `mcl.function_mapping_rules`
2. **–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ** - PostgreSQL –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–æ–∑–¥–∞—é—Ç—Å—è –¥–æ –º–∏–≥—Ä–∞—Ü–∏–∏
3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `postgres_definition` –≤ DDL –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
4. **–ü–æ–ª–Ω–∞—è —Ç—Ä–∞—Å—Å–∏—Ä—É–µ–º–æ—Å—Ç—å** - —Å–≤—è–∑—å –æ–±—ä–µ–∫—Ç ‚Üí –ø—Ä–∞–≤–∏–ª–æ –º–∞–ø–ø–∏–Ω–≥–∞ —á–µ—Ä–µ–∑ –≤–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏:
- **`postgres_default_constraints`**: `function_mapping_rule_id` (FK), `postgres_definition`
- **`postgres_columns`**: `computed_function_mapping_rule_id` (FK), `postgres_computed_definition`
- **`postgres_check_constraints`**: `function_mapping_rule_id` (FK), `postgres_definition`
- **`postgres_indexes`**: `function_mapping_rule_id` (FK), `postgres_definition`

### –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≤ –ø—Ä–æ—Ü–µ—Å—Å–∞—Ö –º–∏–≥—Ä–∞—Ü–∏–∏:

#### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è DDL —Å –º–∞–ø–ø–∏–Ω–≥–æ–º —Ñ—É–Ω–∫—Ü–∏–π:
```python
def generate_table_ddl_with_mapping(target_table_id):
    """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è DDL —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º postgres_definition"""
    query = """
    SELECT 
        pc.column_name,
        pdt.typname_with_params as postgres_type,
        pc.is_nullable,
        pc.is_identity,
        COALESCE(pdc.postgres_definition, pc.default_value) as default_value,
        pc.postgres_computed_definition
    FROM mcl.postgres_tables pt
    JOIN mcl.postgres_columns pc ON pt.id = pc.table_id
    JOIN mcl.postgres_derived_types pdt ON pc.postgres_data_type_id = pdt.id
    LEFT JOIN mcl.postgres_default_constraints pdc ON pc.id = pdc.column_id
    WHERE pt.id = %s
    ORDER BY pc.ordinal_position
    """
    # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ postgres_definition –¥–ª—è default values
    # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ postgres_computed_definition –¥–ª—è computed columns
```

#### –°–æ–∑–¥–∞–Ω–∏–µ default constraints —Å –º–∞–ø–ø–∏–Ω–≥–æ–º:
```python
def create_default_constraints_with_mapping(target_table_id, table_name):
    """–°–æ–∑–¥–∞–Ω–∏–µ default constraints —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º postgres_definition"""
    query = """
    SELECT 
        pdc.constraint_name,
        pdc.postgres_definition,
        pc.column_name
    FROM mcl.postgres_default_constraints pdc
    JOIN mcl.postgres_columns pc ON pdc.column_id = pc.id
    WHERE pdc.table_id = %s
    """
    # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ postgres_definition –≤–º–µ—Å—Ç–æ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ definition
```

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º–∞–ø–ø–∏–Ω–≥–∞ (–¥–ª—è –∑–∞–¥–∞—á–∏ ID=2):
- **Default constraints**: 17 —Å–ª—É—á–∞–µ–≤ `getdate() ‚Üí NOW()`
- **Computed columns**: 59 —Å–ª—É—á–∞–µ–≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
- **–û–±—â–µ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ**: 100% –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤

### –§—É–Ω–∫—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã –º–∞–ø–ø–∏–Ω–≥–∞:
- `apply_function_mapping(definition: str, rule_id: int) -> str`
- `map_default_constraints_functions(task_id: int) -> int`
- `map_computed_columns_functions(task_id: int) -> int`
- `validate_function_mapping_coverage(task_id: int) -> bool`

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–¥–∞—á–∏:
- `task_id` - –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∑–∞–¥–∞—á–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 2)
- `task_name` - –Ω–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ –º–∏–≥—Ä–∞—Ü–∏–∏
- `task_description` - –æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏
- `created_at` - –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á–∏

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã:
–í—Å–µ SQL-–∑–∞–ø—Ä–æ—Å—ã –∫ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º –¥–æ–ª–∂–Ω—ã –≤–∫–ª—é—á–∞—Ç—å —Ñ–∏–ª—å—Ç—Ä:
```sql
WHERE task_id = <TASK_ID>
```

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
```python
def get_migration_tables(task_id: int):
    """–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ç–∞–±–ª–∏—Ü –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∑–∞–¥–∞—á–∏"""
    cursor.execute('''
        SELECT mt.*, pt.migration_status
        FROM mcl.mssql_tables mt
        JOIN mcl.postgres_tables pt ON mt.id = pt.source_table_id
        WHERE mt.task_id = %s
        ORDER BY mt.object_name
    ''', (task_id,))
```

### –í–∞–ª–∏–¥–∞—Ü–∏—è –∑–∞–¥–∞—á:
```python
def validate_migration_task(task_id: int) -> bool:
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –∏ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ –∑–∞–¥–∞—á–∏ –º–∏–≥—Ä–∞—Ü–∏–∏"""
    cursor.execute('''
        SELECT id, description, created_at
        FROM mcl.migration_tasks
        WHERE id = %s
    ''', (task_id,))
    
    task = cursor.fetchone()
    if not task:
        raise ValueError(f"–ó–∞–¥–∞—á–∞ –º–∏–≥—Ä–∞—Ü–∏–∏ —Å ID {task_id} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞")
    
    return True

def validate_table_belongs_to_task(table_id: int, task_id: int) -> bool:
    """–ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ —Ç–∞–±–ª–∏—Ü–∞ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç —É–∫–∞–∑–∞–Ω–Ω–æ–π –∑–∞–¥–∞—á–µ"""
    cursor.execute('''
        SELECT COUNT(*) FROM mcl.mssql_tables
        WHERE id = %s AND task_id = %s
    ''', (table_id, task_id))
    
    count = cursor.fetchone()[0]
    if count == 0:
        raise ValueError(f"–¢–∞–±–ª–∏—Ü–∞ {table_id} –Ω–µ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –∑–∞–¥–∞—á–µ {task_id}")
    
    return True
```

---

## üèóÔ∏è –ò–ï–†–ê–†–•–ò–Ø –û–ë–™–ï–ö–¢–û–í –í –°–•–ï–ú–ï MCL

### üìä **–†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–µ —Ç–∞–±–ª–∏—Ü—ã (—É—Ä–æ–≤–µ–Ω—å 1)**
- `mssql_objects` - –∏—Å—Ö–æ–¥–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã MS SQL
- `postgres_objects` - —Ü–µ–ª–µ–≤—ã–µ –æ–±—ä–µ–∫—Ç—ã PostgreSQL

### üìä **–î–æ—á–µ—Ä–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã (—É—Ä–æ–≤–µ–Ω—å 2)**
- `mssql_tables` - –∏—Å—Ö–æ–¥–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã MS SQL
- `postgres_tables` - —Ü–µ–ª–µ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã PostgreSQL

### üìä **–°–≤—è–∑–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã (—É—Ä–æ–≤–µ–Ω—å 3)**
- `mssql_columns` / `postgres_columns` - –∫–æ–ª–æ–Ω–∫–∏
- `mssql_indexes` / `postgres_indexes` - –∏–Ω–¥–µ–∫—Å—ã
- `mssql_primary_keys` / `postgres_primary_keys` - –ø–µ—Ä–≤–∏—á–Ω—ã–µ –∫–ª—é—á–∏
- `mssql_foreign_keys` / `postgres_foreign_keys` - –≤–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏
- `mssql_unique_constraints` / `postgres_unique_constraints` - —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
- `mssql_check_constraints` / `postgres_check_constraints` - –ø—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
- `mssql_default_constraints` / `postgres_default_constraints` - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- `mssql_triggers` / `postgres_triggers` - —Ç—Ä–∏–≥–≥–µ—Ä—ã
- `mssql_identity_columns` / `postgres_sequences` - identity –∫–æ–ª–æ–Ω–∫–∏/–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- `problems_tb_slt_mp` - –ø—Ä–æ–±–ª–µ–º—ã –∏ –∏—Ö —Ä–µ—à–µ–Ω–∏—è

### üìä **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–ª—É–∂–µ–±–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã**
- `migration_tasks` - –∑–∞–¥–∞—á–∏ –º–∏–≥—Ä–∞—Ü–∏–∏
- `mssql_base_types` / `postgres_base_types` - –±–∞–∑–æ–≤—ã–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö
- `mssql_derived_types` / `postgres_derived_types` - –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—ã–µ —Ç–∏–ø—ã
- `problems` - –æ–±—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –º–∏–≥—Ä–∞—Ü–∏–∏
- `problems_tb` / `problems_ct` / `problems_cm` - –ø—Ä–æ–±–ª–µ–º—ã –ø–æ —Ç–∏–ø–∞–º –æ–±—ä–µ–∫—Ç–æ–≤
- `v_*` - –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–æ–±–ª–µ–º

### üìä **–°–≤—è–∑—É—é—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã**
- `mssql_foreign_key_columns` / `postgres_foreign_key_columns` - –∫–æ–ª–æ–Ω–∫–∏ –≤–Ω–µ—à–Ω–∏—Ö –∫–ª—é—á–µ–π
- `mssql_index_columns` / `postgres_index_columns` - –∫–æ–ª–æ–Ω–∫–∏ –∏–Ω–¥–µ–∫—Å–æ–≤
- `mssql_primary_key_columns` / `postgres_primary_key_columns` - –∫–æ–ª–æ–Ω–∫–∏ –ø–µ—Ä–≤–∏—á–Ω—ã—Ö –∫–ª—é—á–µ–π
- `mssql_unique_constraint_columns` / `postgres_unique_constraint_columns` - –∫–æ–ª–æ–Ω–∫–∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π

### üîó **–°–≤—è–∑–∏ –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏**
- `mssql_objects.id` ‚Üí `mssql_tables.object_id`
- `postgres_objects.id` ‚Üí `postgres_tables.object_id`
- `mssql_tables.id` ‚Üí `mssql_columns.table_id`
- `postgres_tables.id` ‚Üí `postgres_columns.table_id`
- `postgres_tables.source_table_id` ‚Üí `mssql_tables.id`

---

## üöÄ –ü–û–õ–ù–´–ô –ü–†–û–¶–ï–°–° –ú–ò–ì–†–ê–¶–ò–ò –û–¢–î–ï–õ–¨–ù–û–ô –¢–ê–ë–õ–ò–¶–´

### üîç **–≠–¢–ê–ü 0: –ü–†–û–í–ï–†–ö–ê –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ô –ö –ë–ê–ó–ê–ú –î–ê–ù–ù–´–•**

#### 0.1 –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
```python
import yaml
import pyodbc
import psycopg2
from rich.console import Console

def load_config(config_path="/home/alex/projects/sql/femcl/config/config.yaml"):
    """–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏–∑ —Ñ–∞–π–ª–∞"""
    with open(config_path, 'r', encoding='utf-8') as file:
        return yaml.safe_load(file)

config = load_config()
console = Console()
```

#### 0.2 –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ MS SQL Server
```python
def check_mssql_connection():
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ MS SQL Server"""
    try:
        mssql_config = config['database']['mssql']
        
        connection_string = (
            f"DRIVER={{{mssql_config['driver']}}};"
            f"SERVER={mssql_config['server']},{mssql_config['port']};"
            f"DATABASE={mssql_config['database']};"
            f"UID={mssql_config['user']};"
            f"PWD={mssql_config['password']};"
            f"TrustServerCertificate={'yes' if mssql_config['trust_certificate'] else 'no'};"
            f"Connection Timeout={mssql_config['connection_timeout']};"
            f"Command Timeout={mssql_config['command_timeout']};"
        )
        
        conn = pyodbc.connect(connection_string)
        cursor = conn.cursor()
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
        cursor.execute("SELECT DB_NAME() as current_database")
        result = cursor.fetchone()
        current_db = result[0]
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ö–µ–º—ã mcl
        cursor.execute("""
            SELECT COUNT(*) as table_count
            FROM information_schema.tables 
            WHERE table_schema = 'mcl'
        """)
        result = cursor.fetchone()
        mcl_tables_count = result[0]
        
        conn.close()
        
        console.print(f"‚úÖ MS SQL Server: {mssql_config['server']}:{mssql_config['port']}")
        console.print(f"üìä –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: {current_db}")
        console.print(f"üìä –¢–∞–±–ª–∏—Ü –≤ —Å—Ö–µ–º–µ mcl: {mcl_tables_count}")
        
        return True
        
    except Exception as e:
        console.print(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ MS SQL Server: {e}")
        return False
```

#### 0.3 –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL
```python
def check_postgres_connection():
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL"""
    try:
        postgres_config = config['database']['postgres']
        
        conn = psycopg2.connect(
            host=postgres_config['host'],
            port=postgres_config['port'],
            dbname=postgres_config['database'],
            user=postgres_config['user'],
            password=postgres_config['password'],
            connect_timeout=postgres_config['connection_timeout'],
            sslmode=postgres_config['ssl_mode']
        )
        
        cursor = conn.cursor()
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
        cursor.execute("SELECT current_database()")
        result = cursor.fetchone()
        current_db = result[0]
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ö–µ–º—ã mcl
        cursor.execute("""
            SELECT COUNT(*) as table_count
            FROM information_schema.tables 
            WHERE table_schema = 'mcl'
        """)
        result = cursor.fetchone()
        mcl_tables_count = result[0]
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ö–µ–º—ã ags
        cursor.execute("""
            SELECT COUNT(*) as table_count
            FROM information_schema.tables 
            WHERE table_schema = 'ags'
        """)
        result = cursor.fetchone()
        ags_tables_count = result[0]
        
        conn.close()
        
        console.print(f"‚úÖ PostgreSQL: {postgres_config['host']}:{postgres_config['port']}")
        console.print(f"üìä –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: {current_db}")
        console.print(f"üìä –¢–∞–±–ª–∏—Ü –≤ —Å—Ö–µ–º–µ mcl: {mcl_tables_count}")
        console.print(f"üìä –¢–∞–±–ª–∏—Ü –≤ —Å—Ö–µ–º–µ ags: {ags_tables_count}")
        
        return True
        
    except Exception as e:
        console.print(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL: {e}")
        return False
```

#### 0.4 –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
```python
def check_database_connections():
    """–ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∫ –±–∞–∑–∞–º –¥–∞–Ω–Ω—ã—Ö"""
    
    console.print("[bold blue]üîç –ü–†–û–í–ï–†–ö–ê –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ô –ö –ë–ê–ó–ê–ú –î–ê–ù–ù–´–•[/bold blue]")
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ MS SQL Server
    console.print("\n[blue]–ü—Ä–æ–≤–µ—Ä–∫–∞ MS SQL Server...[/blue]")
    mssql_ok = check_mssql_connection()
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ PostgreSQL
    console.print("\n[blue]–ü—Ä–æ–≤–µ—Ä–∫–∞ PostgreSQL...[/blue]")
    postgres_ok = check_postgres_connection()
    
    # –ò—Ç–æ–≥–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
    if mssql_ok and postgres_ok:
        console.print("\n[green]‚úÖ –í—Å–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–∞–º –¥–∞–Ω–Ω—ã—Ö —É—Å–ø–µ—à–Ω—ã![/green]")
        return True
    else:
        console.print("\n[red]‚ùå –û—à–∏–±–∫–∏ –≤ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è—Ö –∫ –±–∞–∑–∞–º –¥–∞–Ω–Ω—ã—Ö![/red]")
        return False
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏:**
- ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ MS SQL Server —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
- ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
- ‚úÖ –°—Ö–µ–º–∞ `mcl` –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ –æ–±–µ–∏—Ö –±–∞–∑–∞—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –°—Ö–µ–º–∞ `ags` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ PostgreSQL
- ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

### üîç **–≠–¢–ê–ü 1: –û–ü–†–ï–î–ï–õ–ï–ù–ò–ï –ò–ú–ï–ù–ò –¶–ï–õ–ï–í–û–ô –¢–ê–ë–õ–ò–¶–´**

#### 1.1 –ü–æ–∏—Å–∫ –∏—Å—Ö–æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã –≤ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
```sql
-- –ü–æ–∏—Å–∫ —Ç–∞–±–ª–∏—Ü—ã –≤ mssql_tables –ø–æ –∏–º–µ–Ω–∏
SELECT id, object_name, schema_name, object_type, row_count, column_count
FROM mcl.mssql_tables 
WHERE object_name = '<table_name>';
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏:**
- ‚úÖ –ó–∞–ø–∏—Å—å –Ω–∞–π–¥–µ–Ω–∞ –≤ `mssql_tables`
- ‚úÖ `object_type` = 'BASE TABLE'
- ‚úÖ `schema_name` –æ–ø—Ä–µ–¥–µ–ª–µ–Ω
- ‚úÖ `row_count` –∏ `column_count` –∑–∞–ø–æ–ª–Ω–µ–Ω—ã

#### 1.2 –ü–æ–ª—É—á–µ–Ω–∏–µ ID –∏—Å—Ö–æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã
```sql
-- –ü–æ–ª—É—á–µ–Ω–∏–µ ID –∏—Å—Ö–æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã
SELECT id as source_table_id
FROM mcl.mssql_tables 
WHERE object_name = '<table_name>';
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** `source_table_id` - ID –∏—Å—Ö–æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –ø–æ–∏—Å–∫–∞

#### 1.3 –ü–æ–∏—Å–∫ —Ü–µ–ª–µ–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã –ø–æ source_table_id
```sql
-- –ü–æ–∏—Å–∫ —Ü–µ–ª–µ–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã –ø–æ ID –∏—Å—Ö–æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã
SELECT id, source_table_id, object_name, schema_name, object_type, migration_status
FROM mcl.postgres_tables 
WHERE source_table_id = <source_table_id>;
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏:**
- ‚úÖ –ó–∞–ø–∏—Å—å –Ω–∞–π–¥–µ–Ω–∞ –≤ `postgres_tables`
- ‚úÖ `source_table_id` —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∏—Å—Ö–æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ
- ‚úÖ `object_name` –æ–ø—Ä–µ–¥–µ–ª–µ–Ω (–∏–º—è —Ü–µ–ª–µ–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã)
- ‚úÖ `migration_status` –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ

#### 1.4 –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–º–µ–Ω–∏ —Ü–µ–ª–µ–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã
```sql
-- –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–º–µ–Ω–∏ —Ü–µ–ª–µ–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã
SELECT object_name as target_table_name
FROM mcl.postgres_tables 
WHERE source_table_id = <source_table_id>;
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** `target_table_name` - –∏–º—è —Ü–µ–ª–µ–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏ –ø–µ—Ä–µ–Ω–æ—Å–∞ –¥–∞–Ω–Ω—ã—Ö

### üîç **–≠–¢–ê–ü 2: –ü–û–î–ì–û–¢–û–í–ö–ê –ö –ú–ò–ì–†–ê–¶–ò–ò**

#### 2.1 –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞
```bash
# –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –º–∏–≥—Ä–∞—Ü–∏–∏ –∏–∑ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
SOURCE_TABLE_ID=<source_table_id>      # ID –∏—Å—Ö–æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã –∏–∑ mcl.mssql_tables
TARGET_TABLE_ID=<target_table_id>      # ID —Ü–µ–ª–µ–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã –∏–∑ mcl.postgres_tables
SOURCE_TABLE_NAME=<source_table_name>   # –ò–º—è –∏—Å—Ö–æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã
TARGET_TABLE_NAME=<target_table_name>   # –ò–º—è —Ü–µ–ª–µ–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã –∏–∑ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
SOURCE_SCHEMA=ags                       # –°—Ö–µ–º–∞ –∏—Å—Ö–æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã
TARGET_SCHEMA=ags                       # –°—Ö–µ–º–∞ —Ü–µ–ª–µ–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã
```

#### 2.2 –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏–∑ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
```python
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –º–∏–≥—Ä–∞—Ü–∏–∏ –∏–∑ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
def validate_migration_parameters_from_metadata(table_name):
    """–í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –º–∏–≥—Ä–∞—Ü–∏–∏ –∏–∑ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö"""
    
    # 1. –ü–æ–∏—Å–∫ –∏—Å—Ö–æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã
    source_query = """
    SELECT id, object_name, schema_name, row_count, column_count
    FROM mcl.mssql_tables 
    WHERE object_name = %s
    """
    source_table = execute_query(source_query, (table_name,))
    
    if not source_table:
        raise ValueError(f"–ò—Å—Ö–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ {table_name} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ mssql_tables")
    
    source_table_id = source_table[0]['id']
    
    # 2. –ü–æ–∏—Å–∫ —Ü–µ–ª–µ–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã
    target_query = """
    SELECT id, object_name, schema_name, migration_status
    FROM mcl.postgres_tables 
    WHERE source_table_id = %s
    """
    target_table = execute_query(target_query, (source_table_id,))
    
    if not target_table:
        raise ValueError(f"–¶–µ–ª–µ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ –¥–ª—è {table_name} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ postgres_tables")
    
    # 3. –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
    if source_table_id <= 0:
        raise ValueError("SOURCE_TABLE_ID –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º")
    
    if target_table[0]['id'] <= 0:
        raise ValueError("TARGET_TABLE_ID –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º")
    
    if not target_table[0]['object_name']:
        raise ValueError("TARGET_TABLE_NAME –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –≤ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö")
    
    return {
        'source_table_id': source_table_id,
        'target_table_id': target_table[0]['id'],
        'source_table_name': table_name,
        'target_table_name': target_table[0]['object_name'],
        'source_schema': source_table[0]['schema_name'],
        'target_schema': target_table[0]['schema_name'],
        'migration_status': target_table[0]['migration_status']
    }
```

#### 2.3 –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- ‚úÖ **–ü–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î:** MS SQL Server –∏ PostgreSQL –∞–∫—Ç–∏–≤–Ω—ã
- ‚úÖ **–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ:** –ó–∞–ø–æ–ª–Ω–µ–Ω—ã –≤ —Å—Ö–µ–º–µ `mcl`
- ‚úÖ **–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:** –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ **–°—Ö–µ–º–∞ `ags`:** –°—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ PostgreSQL
- ‚úÖ **–°–≤—è–∑—å —Ç–∞–±–ª–∏—Ü:** –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ —á–µ—Ä–µ–∑ `source_table_id`

### üîç **–≠–¢–ê–ü 3: –ü–†–û–í–ï–†–ö–ê –ì–û–¢–û–í–ù–û–°–¢–ò –¢–ê–ë–õ–ò–¶–´**

> **üìã –°—Å—ã–ª–∫–∞ –Ω–∞ –º–æ–¥—É–ª—å:** [`TABLE_READINESS_CHECK_RULES.md`](./TABLE_READINESS_CHECK_RULES.md)

#### 3.1 –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤—è–∑–∏ –∏—Å—Ö–æ–¥–Ω–æ–π –∏ —Ü–µ–ª–µ–≤–æ–π —Ç–∞–±–ª–∏—Ü
```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Å–≤—è–∑–∏ –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏
SELECT 
    mt.object_name as source_name,
    pt.object_name as target_name,
    mt.id as source_id,
    pt.id as target_id,
    pt.migration_status
FROM mcl.mssql_tables mt
JOIN mcl.postgres_tables pt ON mt.id = pt.source_table_id
WHERE mt.object_name = '<table_name>';
```

#### 3.2 –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤
SELECT 'parent_objects' as check_type, 
       CASE WHEN EXISTS(SELECT 1 FROM mcl.mssql_objects WHERE id = <source_table_id>) 
            AND EXISTS(SELECT 1 FROM mcl.postgres_objects WHERE id = <target_table_id>)
            THEN 1 ELSE 0 END as is_ready;

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—á–µ—Ä–Ω–∏—Ö —Ç–∞–±–ª–∏—Ü
SELECT 'child_tables' as check_type,
       CASE WHEN EXISTS(SELECT 1 FROM mcl.mssql_tables WHERE id = <source_table_id>)
            AND EXISTS(SELECT 1 FROM mcl.postgres_tables WHERE id = <target_table_id>)
            THEN 1 ELSE 0 END as is_ready;
```

#### 2.2 –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
- ‚úÖ **100% –ì–û–¢–û–í–ê:** –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã, –º–æ–∂–Ω–æ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –∫ —Å–æ–∑–¥–∞–Ω–∏—é
- ‚ö†Ô∏è **95-99% –ì–û–¢–û–í–ê:** –ù–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã, —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ—Ä–∞–±–æ—Ç–∫–∞
- ‚ùå **<95% –ì–û–¢–û–í–ê:** –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã, –º–∏–≥—Ä–∞—Ü–∏—è –Ω–µ–≤–æ–∑–º–æ–∂–Ω–∞

#### 2.3 –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º (–µ—Å–ª–∏ –µ—Å—Ç—å)
```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º
SELECT problem_name, severity_level, problem_description
FROM mcl.problems_tb_slt_mp 
WHERE table_id = <table_id>
ORDER BY severity_level DESC;
```

### üîç **–≠–¢–ê–ü 4: –°–û–ó–î–ê–ù–ò–ï –°–¢–†–£–ö–¢–£–†–´ –¢–ê–ë–õ–ò–¶–´**

> **üìã –°—Å—ã–ª–∫–∞ –Ω–∞ –º–æ–¥—É–ª—å:** [`TABLE_CREATION_RULES.md`](./TABLE_CREATION_RULES.md)

#### 4.1 –ì–µ–Ω–µ—Ä–∞—Ü–∏—è DDL –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã
```sql
-- –ü–æ–ª—É—á–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ DDL
SELECT 
    pc.column_name,
    pdt.typname_with_params as postgres_type,
    pc.is_nullable,
    pc.is_identity,
    pc.default_value
FROM mcl.postgres_tables pt
JOIN mcl.postgres_columns pc ON pt.id = pc.table_id
JOIN mcl.postgres_derived_types pdt ON pc.postgres_data_type_id = pdt.id
WHERE pt.id = <target_table_id>
ORDER BY pc.ordinal_position;
```

#### 4.2 –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –≤ PostgreSQL
```sql
-- –ü—Ä–∏–º–µ—Ä DDL –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã accnt
CREATE TABLE ags.accnt (
    account_key INTEGER GENERATED ALWAYS AS IDENTITY,
    account_num INTEGER,
    account_name VARCHAR(255)
);
```

#### 4.3 –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã
```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å–æ–∑–¥–∞–Ω–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã
SELECT 
    table_schema,
    table_name,
    column_name,
    data_type,
    is_nullable,
    column_default
FROM information_schema.columns 
WHERE table_schema = 'ags' AND table_name = '<table_name>'
ORDER BY ordinal_position;
```

#### 4.4 –°–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä–≤–∏—á–Ω—ã—Ö –∫–ª—é—á–µ–π
```sql
-- –ü–æ–ª—É—á–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–≤–∏—á–Ω—ã—Ö –∫–ª—é—á–µ–π
SELECT 
    ppk.constraint_name,
    ppkc.ordinal_position,
    pc.column_name
FROM mcl.postgres_primary_keys ppk
JOIN mcl.postgres_primary_key_columns ppkc ON ppk.id = ppkc.primary_key_id
JOIN mcl.postgres_columns pc ON ppkc.column_id = pc.id
WHERE ppk.table_id = <target_table_id>
ORDER BY ppkc.ordinal_position;

-- –°–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä–≤–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞
ALTER TABLE <target_schema>.<target_table_name> 
ADD CONSTRAINT <constraint_name> PRIMARY KEY (<column_list>);
```

#### 4.5 –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤
```sql
-- –ü–æ–ª—É—á–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤
SELECT 
    pi.index_name,
    pi.index_type,
    pi.is_unique,
    pic.ordinal_position,
    pc.column_name,
    pic.is_descending
FROM mcl.postgres_indexes pi
JOIN mcl.postgres_index_columns pic ON pi.id = pic.index_id
JOIN mcl.postgres_columns pc ON pic.column_id = pc.id
WHERE pi.table_id = <target_table_id>
ORDER BY pi.index_name, pic.ordinal_position;

-- –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤
CREATE [UNIQUE] INDEX <index_name> ON <target_schema>.<target_table_name> 
(<column_list> [ASC|DESC]);
```

#### 4.6 –°–æ–∑–¥–∞–Ω–∏–µ –≤–Ω–µ—à–Ω–∏—Ö –∫–ª—é—á–µ–π
```sql
-- –ü–æ–ª—É—á–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –≤–Ω–µ—à–Ω–∏—Ö –∫–ª—é—á–µ–π
SELECT 
    pfk.constraint_name,
    pfk.referenced_table_id,
    pfkc.ordinal_position,
    pc.column_name,
    pfkc.referenced_column_name,
    pfk.delete_action,
    pfk.update_action
FROM mcl.postgres_foreign_keys pfk
JOIN mcl.postgres_foreign_key_columns pfkc ON pfk.id = pfkc.foreign_key_id
JOIN mcl.postgres_columns pc ON pfkc.column_id = pc.id
WHERE pfk.table_id = <target_table_id>
ORDER BY pfk.constraint_name, pfkc.ordinal_position;

-- –°–æ–∑–¥–∞–Ω–∏–µ –≤–Ω–µ—à–Ω–∏—Ö –∫–ª—é—á–µ–π
ALTER TABLE <target_schema>.<target_table_name> 
ADD CONSTRAINT <constraint_name> 
FOREIGN KEY (<column_list>) 
REFERENCES <referenced_schema>.<referenced_table> (<referenced_columns>)
ON DELETE <delete_action> ON UPDATE <update_action>;
```

#### 4.7 –°–æ–∑–¥–∞–Ω–∏–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
```sql
-- –ü–æ–ª—É—á–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
SELECT 
    puc.constraint_name,
    pucc.ordinal_position,
    pc.column_name
FROM mcl.postgres_unique_constraints puc
JOIN mcl.postgres_unique_constraint_columns pucc ON puc.id = pucc.unique_constraint_id
JOIN mcl.postgres_columns pc ON pucc.column_id = pc.id
WHERE puc.table_id = <target_table_id>
ORDER BY puc.constraint_name, pucc.ordinal_position;

-- –°–æ–∑–¥–∞–Ω–∏–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
ALTER TABLE <target_schema>.<target_table_name> 
ADD CONSTRAINT <constraint_name> UNIQUE (<column_list>);
```

#### 4.8 –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–æ—á–Ω—ã—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
```sql
-- –ü–æ–ª—É—á–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ—á–Ω—ã—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
SELECT 
    pcc.constraint_name,
    pcc.check_definition
FROM mcl.postgres_check_constraints pcc
WHERE pcc.table_id = <target_table_id>;

-- –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–æ—á–Ω—ã—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
ALTER TABLE <target_schema>.<target_table_name> 
ADD CONSTRAINT <constraint_name> CHECK (<check_definition>);
```

#### 4.9 –°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤
```sql
-- –ü–æ–ª—É—á–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤
SELECT 
    pt.trigger_name,
    pt.trigger_event,
    pt.trigger_timing,
    pt.trigger_definition
FROM mcl.postgres_triggers pt
WHERE pt.table_id = <target_table_id>;

-- –°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤
CREATE TRIGGER <trigger_name>
    <trigger_timing> <trigger_event> ON <target_schema>.<target_table_name>
    FOR EACH ROW
    EXECUTE FUNCTION <trigger_definition>;
```

#### 4.10 –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π (–¥–ª—è identity –∫–æ–ª–æ–Ω–æ–∫)
```sql
-- –ü–æ–ª—É—á–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π
SELECT 
    ps.sequence_name,
    ps.start_value,
    ps.minimum_value,
    ps.maximum_value,
    ps.increment,
    ps.cycle_option
FROM mcl.postgres_sequences ps
WHERE ps.table_id = <target_table_id>;

-- –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π
CREATE SEQUENCE <target_schema>.<sequence_name>
    START WITH <start_value>
    INCREMENT BY <increment>
    MINVALUE <minimum_value>
    MAXVALUE <maximum_value>
    CYCLE;
```

#### 4.11 –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª–Ω–æ—Ç—ã —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Ç–∞–±–ª–∏—Ü—ã
SELECT 
    'columns' as element_type,
    COUNT(*) as count
FROM information_schema.columns 
WHERE table_schema = '<target_schema>' AND table_name = '<target_table_name>'

UNION ALL

SELECT 
    'primary_keys' as element_type,
    COUNT(*) as count
FROM information_schema.table_constraints 
WHERE table_schema = '<target_schema>' AND table_name = '<target_table_name>' 
AND constraint_type = 'PRIMARY KEY'

UNION ALL

SELECT 
    'indexes' as element_type,
    COUNT(*) as count
FROM pg_indexes 
WHERE schemaname = '<target_schema>' AND tablename = '<target_table_name>'

UNION ALL

SELECT 
    'foreign_keys' as element_type,
    COUNT(*) as count
FROM information_schema.table_constraints 
WHERE table_schema = '<target_schema>' AND table_name = '<target_table_name>' 
AND constraint_type = 'FOREIGN KEY'

UNION ALL

SELECT 
    'unique_constraints' as element_type,
    COUNT(*) as count
FROM information_schema.table_constraints 
WHERE table_schema = '<target_schema>' AND table_name = '<target_table_name>' 
AND constraint_type = 'UNIQUE'

UNION ALL

SELECT 
    'check_constraints' as element_type,
    COUNT(*) as count
FROM information_schema.table_constraints 
WHERE table_schema = '<target_schema>' AND table_name = '<target_table_name>' 
AND constraint_type = 'CHECK'

UNION ALL

SELECT 
    'triggers' as element_type,
    COUNT(*) as count
FROM information_schema.triggers 
WHERE event_object_schema = '<target_schema>' AND event_object_table = '<target_table_name>'

UNION ALL

SELECT 
    'sequences' as element_type,
    COUNT(*) as count
FROM information_schema.sequences 
WHERE sequence_schema = '<target_schema>' AND sequence_name LIKE '<target_table_name>%';
```

### üîç **–≠–¢–ê–ü 5: –ü–ï–†–ï–ù–û–° –î–ê–ù–ù–´–•**

> **üìã –°—Å—ã–ª–∫–∞ –Ω–∞ –º–æ–¥—É–ª—å:** [`DATA_MIGRATION_RULES.md`](./DATA_MIGRATION_RULES.md)

#### 5.1 –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ MS SQL Server
```python
# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ MS SQL Server
mssql_conn = pyodbc.connect(
    f"DRIVER={{ODBC Driver 17 for SQL Server}};"
    f"SERVER={server},{port};"
    f"DATABASE={database};"
    f"UID={username};"
    f"PWD={password};"
    "TrustServerCertificate=yes;"
)

# –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∏–º–µ–Ω–∏ –∏–∑ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
query = f"SELECT * FROM {source_schema}.{source_table_name} ORDER BY {primary_key_column}"
df = pd.read_sql(query, mssql_conn)
```

#### 5.2 –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ PostgreSQL
```python
# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL
pg_conn = psycopg2.connect(
    host=host, port=port, dbname=database, 
    user=username, password=password
)

# –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∏–º–µ–Ω–∏ –∏–∑ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
sql = f"INSERT INTO {target_schema}.{target_table_name} ({columns}) OVERRIDING SYSTEM VALUE VALUES ({placeholders})"
cursor.execute(sql, values)
```

#### 5.3 –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–µ—Ä–µ–Ω–æ—Å–∞
```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å—Ç—Ä–æ–∫ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∏–º–µ–Ω–∏ –∏–∑ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
SELECT COUNT(*) as row_count FROM <target_schema>.<target_table_name>;

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö
SELECT * FROM <target_schema>.<target_table_name> ORDER BY <primary_key_column> LIMIT 5;
```

---

## üìä –ö–û–û–†–î–ò–ù–ê–¶–ò–Ø –ú–û–î–£–õ–ï–ô

### üîÑ **–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**

```mermaid
graph TD
    A[–ù–∞—á–∞–ª–æ –º–∏–≥—Ä–∞—Ü–∏–∏] --> B[–ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏]
    B --> C{–ì–æ—Ç–æ–≤–∞?}
    C -->|–î–∞| D[–°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã]
    C -->|–ù–µ—Ç| E[–†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º]
    E --> B
    D --> D1[–°–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä–≤–∏—á–Ω—ã—Ö –∫–ª—é—á–µ–π]
    D1 --> D2[–°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤]
    D2 --> D3[–°–æ–∑–¥–∞–Ω–∏–µ –≤–Ω–µ—à–Ω–∏—Ö –∫–ª—é—á–µ–π]
    D3 --> D4[–°–æ–∑–¥–∞–Ω–∏–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π]
    D4 --> D5[–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–æ—á–Ω—ã—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π]
    D5 --> D6[–°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤]
    D6 --> D7[–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π]
    D7 --> D8[–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª–Ω–æ—Ç—ã —ç–ª–µ–º–µ–Ω—Ç–æ–≤]
    D8 --> F[–ü–µ—Ä–µ–Ω–æ—Å –¥–∞–Ω–Ω—ã—Ö]
    F --> G[–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤]
    G --> H[–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ]
```

### üîÑ **–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –º–æ–¥—É–ª–µ–π:**

1. **TABLE_READINESS_CHECK_RULES.md** ‚Üí **TABLE_CREATION_RULES.md**
   - –†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã
   - –°—Ç–∞—Ç—É—Å –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ –º–æ–¥—É–ª—å —Å–æ–∑–¥–∞–Ω–∏—è

2. **TABLE_CREATION_RULES.md** ‚Üí **DATA_MIGRATION_RULES.md**
   - –°–æ–∑–¥–∞–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞ –¥–∞–Ω–Ω—ã—Ö
   - –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ –º–æ–¥—É–ª—å –ø–µ—Ä–µ–Ω–æ—Å–∞

3. **DATA_MIGRATION_RULES.md** ‚Üí **SINGLE_TABLE_MIGRATION_RULES.md**
   - –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–µ—Ä–µ–Ω–æ—Å–∞ –¥–∞–Ω–Ω—ã—Ö –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –≤ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –º–æ–¥—É–ª—å
   - –°—Ç–∞—Ç—É—Å –º–∏–≥—Ä–∞—Ü–∏–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ —Å–∏—Å—Ç–µ–º–µ

---

## üéØ –ö–†–ò–¢–ï–†–ò–ò –£–°–ü–ï–®–ù–û–°–¢–ò –ú–ò–ì–†–ê–¶–ò–ò

### ‚úÖ **100% –£–°–ü–ï–®–ù–û**
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ –ø—Ä–æ—à–ª–∞ –ø—Ä–æ–≤–µ—Ä–∫—É –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ **–ü–µ—Ä–≤–∏—á–Ω—ã–µ –∫–ª—é—á–∏ —Å–æ–∑–¥–∞–Ω—ã**
- ‚úÖ **–ò–Ω–¥–µ–∫—Å—ã —Å–æ–∑–¥–∞–Ω—ã**
- ‚úÖ **–í–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏ —Å–æ–∑–¥–∞–Ω—ã (–µ—Å–ª–∏ –µ—Å—Ç—å)**
- ‚úÖ **–£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Å–æ–∑–¥–∞–Ω—ã (–µ—Å–ª–∏ –µ—Å—Ç—å)**
- ‚úÖ **–ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Å–æ–∑–¥–∞–Ω—ã (–µ—Å–ª–∏ –µ—Å—Ç—å)**
- ‚úÖ **–¢—Ä–∏–≥–≥–µ—Ä—ã —Å–æ–∑–¥–∞–Ω—ã (–µ—Å–ª–∏ –µ—Å—Ç—å)**
- ‚úÖ **–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å–æ–∑–¥–∞–Ω—ã (–µ—Å–ª–∏ –µ—Å—Ç—å)**
- ‚úÖ –í—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ –¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞
- ‚úÖ Identity –∫–æ–ª–æ–Ω–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ **–í—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Ç–∞–±–ª–∏—Ü—ã –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç**

### ‚ö†Ô∏è **95-99% –£–°–ü–ï–®–ù–û**
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ –ø—Ä–æ—à–ª–∞ –ø—Ä–æ–≤–µ—Ä–∫—É –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω–∞ —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è–º–∏
- ‚úÖ **–ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å–æ–∑–¥–∞–Ω–æ**
- ‚úÖ –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–æ
- ‚úÖ –ù–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å —Ç–∏–ø–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö
- ‚ö†Ô∏è **–ù–µ–∫–æ—Ç–æ—Ä—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç**

### ‚ùå **<95% –£–°–ü–ï–®–ù–û**
- ‚ùå –¢–∞–±–ª–∏—Ü–∞ –Ω–µ –ø—Ä–æ—à–ª–∞ –ø—Ä–æ–≤–µ—Ä–∫—É –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
- ‚ùå –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–∑–¥–∞–Ω–∞ —Å –æ—à–∏–±–∫–∞–º–∏
- ‚ùå **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç**
- ‚ùå –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–∞—è —á–∞—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –Ω–µ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–∞
- ‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å—é

---

## üöÄ –ê–õ–ì–û–†–ò–¢–ú –£–ü–†–ê–í–õ–ï–ù–ò–Ø –ü–†–û–¶–ï–°–°–û–ú

### 1. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è**
- –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –º–∏–≥—Ä–∞—Ü–∏–∏
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
- –ó–∞–≥—Ä—É–∑–∏—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã

### 2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏**
- –í—ã–ø–æ–ª–Ω–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ (–º–æ–¥—É–ª—å 1)
- –û—Ü–µ–Ω–∏—Ç—å –ø—Ä–æ—Ü–µ–Ω—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
- –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Ä–µ—à–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—ã

### 3. **–°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã**
- –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å DDL –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã (–º–æ–¥—É–ª—å 2)
- –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É –≤ PostgreSQL
- **–°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤–∏—á–Ω—ã–µ –∫–ª—é—á–∏**
- **–°–æ–∑–¥–∞—Ç—å –∏–Ω–¥–µ–∫—Å—ã**
- **–°–æ–∑–¥–∞—Ç—å –≤–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å)**
- **–°–æ–∑–¥–∞—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (–µ—Å–ª–∏ –µ—Å—Ç—å)**
- **–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (–µ—Å–ª–∏ –µ—Å—Ç—å)**
- **–°–æ–∑–¥–∞—Ç—å —Ç—Ä–∏–≥–≥–µ—Ä—ã (–µ—Å–ª–∏ –µ—Å—Ç—å)**
- **–°–æ–∑–¥–∞—Ç—å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å)**
- **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–ª–Ω–æ—Ç—É –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤**

### 4. **–ü–µ—Ä–µ–Ω–æ—Å –¥–∞–Ω–Ω—ã—Ö**
- –ò–∑–≤–ª–µ—á—å –¥–∞–Ω–Ω—ã–µ –∏–∑ MS SQL Server (–º–æ–¥—É–ª—å 3)
- –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ PostgreSQL
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–µ—Ä–µ–Ω–æ—Å–∞

### 5. **–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ**
- –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –º–∏–≥—Ä–∞—Ü–∏–∏
- –°–æ–∑–¥–∞—Ç—å –æ—Ç—á–µ—Ç –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö
- –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Å–ª–µ–¥—É—é—â—É—é —Ç–∞–±–ª–∏—Ü—É

---

## üìã –®–ê–ë–õ–û–ù –£–ü–†–ê–í–õ–ï–ù–ò–Ø –ú–ò–ì–†–ê–¶–ò–ï–ô

```python
#!/usr/bin/env python3
"""
–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –º–æ–¥—É–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–µ–π –æ—Ç–¥–µ–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã
"""
import os
import sys
import yaml
import pyodbc
import psycopg2
from dotenv import load_dotenv
from rich.console import Console

load_dotenv()
console = Console()

# –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
def load_config(config_path="/home/alex/projects/sql/femcl/config/config.yaml"):
    """–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏–∑ —Ñ–∞–π–ª–∞"""
    with open(config_path, 'r', encoding='utf-8') as file:
        return yaml.safe_load(file)

config = load_config()

# –§—É–Ω–∫—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
def check_mssql_connection():
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ MS SQL Server"""
    try:
        mssql_config = config['database']['mssql']
        
        connection_string = (
            f"DRIVER={{{mssql_config['driver']}}};"
            f"SERVER={mssql_config['server']},{mssql_config['port']};"
            f"DATABASE={mssql_config['database']};"
            f"UID={mssql_config['user']};"
            f"PWD={mssql_config['password']};"
            f"TrustServerCertificate={'yes' if mssql_config['trust_certificate'] else 'no'};"
            f"Connection Timeout={mssql_config['connection_timeout']};"
            f"Command Timeout={mssql_config['command_timeout']};"
        )
        
        conn = pyodbc.connect(connection_string)
        cursor = conn.cursor()
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
        cursor.execute("SELECT DB_NAME() as current_database")
        result = cursor.fetchone()
        current_db = result[0]
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ö–µ–º—ã mcl
        cursor.execute("""
            SELECT COUNT(*) as table_count
            FROM information_schema.tables 
            WHERE table_schema = 'mcl'
        """)
        result = cursor.fetchone()
        mcl_tables_count = result[0]
        
        conn.close()
        
        console.print(f"‚úÖ MS SQL Server: {mssql_config['server']}:{mssql_config['port']}")
        console.print(f"üìä –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: {current_db}")
        console.print(f"üìä –¢–∞–±–ª–∏—Ü –≤ —Å—Ö–µ–º–µ mcl: {mcl_tables_count}")
        
        return True
        
    except Exception as e:
        console.print(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ MS SQL Server: {e}")
        return False

def check_postgres_connection():
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL"""
    try:
        postgres_config = config['database']['postgres']
        
        conn = psycopg2.connect(
            host=postgres_config['host'],
            port=postgres_config['port'],
            dbname=postgres_config['database'],
            user=postgres_config['user'],
            password=postgres_config['password'],
            connect_timeout=postgres_config['connection_timeout'],
            sslmode=postgres_config['ssl_mode']
        )
        
        cursor = conn.cursor()
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
        cursor.execute("SELECT current_database()")
        result = cursor.fetchone()
        current_db = result[0]
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ö–µ–º—ã mcl
        cursor.execute("""
            SELECT COUNT(*) as table_count
            FROM information_schema.tables 
            WHERE table_schema = 'mcl'
        """)
        result = cursor.fetchone()
        mcl_tables_count = result[0]
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ö–µ–º—ã ags
        cursor.execute("""
            SELECT COUNT(*) as table_count
            FROM information_schema.tables 
            WHERE table_schema = 'ags'
        """)
        result = cursor.fetchone()
        ags_tables_count = result[0]
        
        conn.close()
        
        console.print(f"‚úÖ PostgreSQL: {postgres_config['host']}:{postgres_config['port']}")
        console.print(f"üìä –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: {current_db}")
        console.print(f"üìä –¢–∞–±–ª–∏—Ü –≤ —Å—Ö–µ–º–µ mcl: {mcl_tables_count}")
        console.print(f"üìä –¢–∞–±–ª–∏—Ü –≤ —Å—Ö–µ–º–µ ags: {ags_tables_count}")
        
        return True
        
    except Exception as e:
        console.print(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL: {e}")
        return False

def check_database_connections():
    """–ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∫ –±–∞–∑–∞–º –¥–∞–Ω–Ω—ã—Ö"""
    
    console.print("[bold blue]üîç –ü–†–û–í–ï–†–ö–ê –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ô –ö –ë–ê–ó–ê–ú –î–ê–ù–ù–´–•[/bold blue]")
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ MS SQL Server
    console.print("\n[blue]–ü—Ä–æ–≤–µ—Ä–∫–∞ MS SQL Server...[/blue]")
    mssql_ok = check_mssql_connection()
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ PostgreSQL
    console.print("\n[blue]–ü—Ä–æ–≤–µ—Ä–∫–∞ PostgreSQL...[/blue]")
    postgres_ok = check_postgres_connection()
    
    # –ò—Ç–æ–≥–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
    if mssql_ok and postgres_ok:
        console.print("\n[green]‚úÖ –í—Å–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–∞–º –¥–∞–Ω–Ω—ã—Ö —É—Å–ø–µ—à–Ω—ã![/green]")
        return True
    else:
        console.print("\n[red]‚ùå –û—à–∏–±–∫–∏ –≤ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è—Ö –∫ –±–∞–∑–∞–º –¥–∞–Ω–Ω—ã—Ö![/red]")
        return False

# –ö–ª–∞—Å—Å—ã –æ—à–∏–±–æ–∫ –º–∏–≥—Ä–∞—Ü–∏–∏
class MigrationError(Exception):
    """–ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è –æ—à–∏–±–æ–∫ –º–∏–≥—Ä–∞—Ü–∏–∏"""
    pass

class TableNotReadyError(MigrationError):
    """–¢–∞–±–ª–∏—Ü–∞ –Ω–µ –≥–æ—Ç–æ–≤–∞ –∫ –º–∏–≥—Ä–∞—Ü–∏–∏"""
    pass

class DataIntegrityError(MigrationError):
    """–û—à–∏–±–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö"""
    pass

class ValidationError(MigrationError):
    """–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤"""
    pass

def validate_migration_parameters_from_metadata(table_name):
    """–í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –º–∏–≥—Ä–∞—Ü–∏–∏ –∏–∑ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö"""
    
    # 1. –ü–æ–∏—Å–∫ –∏—Å—Ö–æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã
    source_query = """
    SELECT id, object_name, schema_name, row_count, column_count
    FROM mcl.mssql_tables 
    WHERE object_name = %s
    """
    source_table = execute_query(source_query, (table_name,))
    
    if not source_table:
        raise ValueError(f"–ò—Å—Ö–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ {table_name} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ mssql_tables")
    
    source_table_id = source_table[0]['id']
    
    # 2. –ü–æ–∏—Å–∫ —Ü–µ–ª–µ–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã
    target_query = """
    SELECT id, object_name, schema_name, migration_status
    FROM mcl.postgres_tables 
    WHERE source_table_id = %s
    """
    target_table = execute_query(target_query, (source_table_id,))
    
    if not target_table:
        raise ValueError(f"–¶–µ–ª–µ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ –¥–ª—è {table_name} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ postgres_tables")
    
    # 3. –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
    if source_table_id <= 0:
        raise ValueError("SOURCE_TABLE_ID –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º")
    
    if target_table[0]['id'] <= 0:
        raise ValueError("TARGET_TABLE_ID –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º")
    
    if not target_table[0]['object_name']:
        raise ValueError("TARGET_TABLE_NAME –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –≤ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö")
    
    return {
        'source_table_id': source_table_id,
        'target_table_id': target_table[0]['id'],
        'source_table_name': table_name,
        'target_table_name': target_table[0]['object_name'],
        'source_schema': source_table[0]['schema_name'],
        'target_schema': target_table[0]['schema_name'],
        'migration_status': target_table[0]['migration_status']
    }

def migrate_single_table(table_name):
    """–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–µ–π –æ—Ç–¥–µ–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö"""
    
    console.print(f"[bold blue]üöÄ –ú–ò–ì–†–ê–¶–ò–Ø –¢–ê–ë–õ–ò–¶–´ {table_name}[/bold blue]")
    
    try:
        # –≠–¢–ê–ü 0: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∫ –±–∞–∑–∞–º –¥–∞–Ω–Ω—ã—Ö
        console.print("[blue]–≠—Ç–∞–ø 0: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∫ –±–∞–∑–∞–º –¥–∞–Ω–Ω—ã—Ö[/blue]")
        if not check_database_connections():
            console.print("[red]‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –±–∞–∑–∞–º –¥–∞–Ω–Ω—ã—Ö![/red]")
            return False
        
        # –≠–¢–ê–ü 1: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏–∑ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
        console.print("[blue]–≠—Ç–∞–ø 1: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –º–∏–≥—Ä–∞—Ü–∏–∏ –∏–∑ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö[/blue]")
        params = validate_migration_parameters_from_metadata(table_name)
        
        console.print(f"üìä –ò—Å—Ö–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞: {params['source_table_name']} (ID: {params['source_table_id']})")
        console.print(f"üìä –¶–µ–ª–µ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞: {params['target_table_name']} (ID: {params['target_table_id']})")
        console.print(f"üìä –°—Ö–µ–º—ã: {params['source_schema']} ‚Üí {params['target_schema']}")
        console.print(f"üìä –°—Ç–∞—Ç—É—Å –º–∏–≥—Ä–∞—Ü–∏–∏: {params['migration_status']}")
    
        # –≠–¢–ê–ü 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
        console.print("[blue]–≠—Ç–∞–ø 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ —Ç–∞–±–ª–∏—Ü—ã[/blue]")
        readiness_result = check_table_readiness(params['source_table_id'], params['target_table_id'])
        
        if readiness_result < 95:
            console.print(f"[red]‚ùå –¢–∞–±–ª–∏—Ü–∞ –Ω–µ –≥–æ—Ç–æ–≤–∞ –∫ –º–∏–≥—Ä–∞—Ü–∏–∏ ({readiness_result}%)[/red]")
            return False
        
        # –≠–¢–ê–ü 3: –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
        console.print("[blue]–≠—Ç–∞–ø 3: –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–∞–±–ª–∏—Ü—ã[/blue]")
        creation_result = create_table_structure(params['target_table_id'], params['target_table_name'])
        
        if not creation_result:
            console.print("[red]‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–∞–±–ª–∏—Ü—ã[/red]")
            return False
        
        # –≠–¢–ê–ü 4: –ü–µ—Ä–µ–Ω–æ—Å –¥–∞–Ω–Ω—ã—Ö
        console.print("[blue]–≠—Ç–∞–ø 4: –ü–µ—Ä–µ–Ω–æ—Å –¥–∞–Ω–Ω—ã—Ö[/blue]")
        migration_result = migrate_table_data(
            params['source_schema'], params['source_table_name'], 
            params['target_schema'], params['target_table_name']
        )
        
        if not migration_result:
            console.print("[red]‚ùå –û—à–∏–±–∫–∞ –ø–µ—Ä–µ–Ω–æ—Å–∞ –¥–∞–Ω–Ω—ã—Ö[/red]")
            return False
        
        # –≠–¢–ê–ü 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        console.print("[blue]–≠—Ç–∞–ø 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤[/blue]")
        verification_result = verify_migration_results(params['target_table_name'])
        
        if verification_result:
            console.print(f"[green]‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è —Ç–∞–±–ª–∏—Ü—ã {table_name} –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ![/green]")
            return True
        else:
            console.print(f"[red]‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –º–∏–≥—Ä–∞—Ü–∏–∏[/red]")
            return False
            
    except ValidationError as e:
        console.print(f"[red]‚ùå –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤: {e}[/red]")
        return False
    except MigrationError as e:
        console.print(f"[red]‚ùå –û—à–∏–±–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏: {e}[/red]")
        return False
    except Exception as e:
        console.print(f"[red]‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –º–∏–≥—Ä–∞—Ü–∏–∏:[/red] {e}")
        return False

def check_table_readiness(table_id, target_table_id):
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ —Ç–∞–±–ª–∏—Ü—ã (–º–æ–¥—É–ª—å 1)"""
    # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ–≥–ª–∞—Å–Ω–æ TABLE_READINESS_CHECK_RULES.md
    pass

def create_table_structure(target_table_id, table_name):
    """–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–∞–±–ª–∏—Ü—ã –≤–∫–ª—é—á–∞—è –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã"""
    
    console.print(f"[blue]–°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–∞–±–ª–∏—Ü—ã {table_name}...[/blue]")
    
    try:
        # 4.1 –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã
        console.print("[blue]4.1 –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã[/blue]")
        create_table_ddl = generate_table_ddl(target_table_id)
        execute_ddl(create_table_ddl)
        
        # 4.2 –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã
        console.print("[blue]4.2 –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã[/blue]")
        verify_table_creation(table_name)
        
        # 4.4 –°–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä–≤–∏—á–Ω—ã—Ö –∫–ª—é—á–µ–π
        console.print("[blue]4.4 –°–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä–≤–∏—á–Ω—ã—Ö –∫–ª—é—á–µ–π[/blue]")
        create_primary_keys(target_table_id, table_name)
        
        # 4.5 –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤
        console.print("[blue]4.5 –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤[/blue]")
        create_indexes(target_table_id, table_name)
        
        # 4.6 –°–æ–∑–¥–∞–Ω–∏–µ –≤–Ω–µ—à–Ω–∏—Ö –∫–ª—é—á–µ–π
        console.print("[blue]4.6 –°–æ–∑–¥–∞–Ω–∏–µ –≤–Ω–µ—à–Ω–∏—Ö –∫–ª—é—á–µ–π[/blue]")
        create_foreign_keys(target_table_id, table_name)
        
        # 4.7 –°–æ–∑–¥–∞–Ω–∏–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
        console.print("[blue]4.7 –°–æ–∑–¥–∞–Ω–∏–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π[/blue]")
        create_unique_constraints(target_table_id, table_name)
        
        # 4.8 –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–æ—á–Ω—ã—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
        console.print("[blue]4.8 –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–æ—á–Ω—ã—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π[/blue]")
        create_check_constraints(target_table_id, table_name)
        
        # 4.9 –°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤
        console.print("[blue]4.9 –°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤[/blue]")
        create_triggers(target_table_id, table_name)
        
        # 4.10 –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π
        console.print("[blue]4.10 –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π[/blue]")
        create_sequences(target_table_id, table_name)
        
        # 4.11 –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª–Ω–æ—Ç—ã —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        console.print("[blue]4.11 –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª–Ω–æ—Ç—ã —ç–ª–µ–º–µ–Ω—Ç–æ–≤[/blue]")
        verify_table_elements(table_name)
        
        console.print(f"[green]‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã {table_name} —Å–æ–∑–¥–∞–Ω–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é![/green]")
        return True
        
    except Exception as e:
        console.print(f"[red]‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–∞–±–ª–∏—Ü—ã: {e}[/red]")
        return False

def migrate_table_data(source_schema, source_table_name, target_schema, target_table_name):
    """–ü–µ—Ä–µ–Ω–æ—Å –¥–∞–Ω–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü—ã (–º–æ–¥—É–ª—å 3)"""
    # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ–≥–ª–∞—Å–Ω–æ DATA_MIGRATION_RULES.md
    pass

def verify_migration_results(table_name):
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –º–∏–≥—Ä–∞—Ü–∏–∏"""
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å—Ç—Ä–æ–∫, —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö –∏ —Ç.–¥.
    pass

# ============================================================================
# –§–£–ù–ö–¶–ò–ò –î–õ–Ø –°–û–ó–î–ê–ù–ò–Ø –≠–õ–ï–ú–ï–ù–¢–û–í –¢–ê–ë–õ–ò–¶–´
# ============================================================================

def generate_table_ddl(target_table_id):
    """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è DDL –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã"""
    query = """
    SELECT 
        pc.column_name,
        pdt.typname_with_params as postgres_type,
        pc.is_nullable,
        pc.is_identity,
        pc.default_value
    FROM mcl.postgres_tables pt
    JOIN mcl.postgres_columns pc ON pt.id = pc.table_id
    JOIN mcl.postgres_derived_types pdt ON pc.postgres_data_type_id = pdt.id
    WHERE pt.id = %s
    ORDER BY pc.ordinal_position
    """
    columns = execute_query(query, (target_table_id,))
    
    ddl_parts = []
    for col in columns:
        col_def = f"    {col['column_name']} {col['postgres_type']}"
        if col['is_identity']:
            col_def += " GENERATED ALWAYS AS IDENTITY"
        if not col['is_nullable']:
            col_def += " NOT NULL"
        if col['default_value']:
            col_def += f" DEFAULT {col['default_value']}"
        ddl_parts.append(col_def)
    
    table_name = get_table_name(target_table_id)
    ddl = f"CREATE TABLE ags.{table_name} (\n" + ",\n".join(ddl_parts) + "\n);"
    return ddl

def execute_ddl(ddl):
    """–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ DDL –∫–æ–º–∞–Ω–¥—ã"""
    # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è DDL
    pass

def verify_table_creation(table_name):
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã"""
    query = """
    SELECT COUNT(*) as column_count
    FROM information_schema.columns 
    WHERE table_schema = 'ags' AND table_name = %s
    """
    result = execute_query(query, (table_name,))
    return result[0]['column_count'] > 0

def create_primary_keys(target_table_id, table_name):
    """–°–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä–≤–∏—á–Ω—ã—Ö –∫–ª—é—á–µ–π"""
    query = """
    SELECT 
        ppk.constraint_name,
        ppkc.ordinal_position,
        pc.column_name
    FROM mcl.postgres_primary_keys ppk
    JOIN mcl.postgres_primary_key_columns ppkc ON ppk.id = ppkc.primary_key_id
    JOIN mcl.postgres_columns pc ON ppkc.column_id = pc.id
    WHERE ppk.table_id = %s
    ORDER BY ppkc.ordinal_position
    """
    pk_data = execute_query(query, (target_table_id,))
    
    if pk_data:
        columns = [row['column_name'] for row in pk_data]
        constraint_name = pk_data[0]['constraint_name']
        ddl = f"ALTER TABLE ags.{table_name} ADD CONSTRAINT {constraint_name} PRIMARY KEY ({', '.join(columns)});"
        execute_ddl(ddl)
        console.print(f"[green]‚úÖ –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á {constraint_name} —Å–æ–∑–¥–∞–Ω[/green]")

def create_indexes(target_table_id, table_name):
    """–°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤"""
    query = """
    SELECT 
        pi.index_name,
        pi.index_type,
        pi.is_unique,
        pic.ordinal_position,
        pc.column_name,
        pic.is_descending
    FROM mcl.postgres_indexes pi
    JOIN mcl.postgres_index_columns pic ON pi.id = pic.index_id
    JOIN mcl.postgres_columns pc ON pic.column_id = pc.id
    WHERE pi.table_id = %s
    ORDER BY pi.index_name, pic.ordinal_position
    """
    index_data = execute_query(query, (target_table_id,))
    
    if index_data:
        # –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –∏–Ω–¥–µ–∫—Å–∞–º
        indexes = {}
        for row in index_data:
            index_name = row['index_name']
            if index_name not in indexes:
                indexes[index_name] = {
                    'is_unique': row['is_unique'],
                    'columns': []
                }
            indexes[index_name]['columns'].append({
                'name': row['column_name'],
                'descending': row['is_descending']
            })
        
        # –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤
        for index_name, index_info in indexes.items():
            columns = []
            for col in index_info['columns']:
                col_def = col['name']
                if col['descending']:
                    col_def += " DESC"
                columns.append(col_def)
            
            unique_keyword = "UNIQUE " if index_info['is_unique'] else ""
            ddl = f"CREATE {unique_keyword}INDEX {index_name} ON ags.{table_name} ({', '.join(columns)});"
            execute_ddl(ddl)
            console.print(f"[green]‚úÖ –ò–Ω–¥–µ–∫—Å {index_name} —Å–æ–∑–¥–∞–Ω[/green]")

def create_foreign_keys(target_table_id, table_name):
    """–°–æ–∑–¥–∞–Ω–∏–µ –≤–Ω–µ—à–Ω–∏—Ö –∫–ª—é—á–µ–π"""
    query = """
    SELECT 
        pfk.constraint_name,
        pfk.referenced_table_id,
        pfkc.ordinal_position,
        pc.column_name,
        pfkc.referenced_column_name,
        pfk.delete_action,
        pfk.update_action
    FROM mcl.postgres_foreign_keys pfk
    JOIN mcl.postgres_foreign_key_columns pfkc ON pfk.id = pfkc.foreign_key_id
    JOIN mcl.postgres_columns pc ON pfkc.column_id = pc.id
    WHERE pfk.table_id = %s
    ORDER BY pfk.constraint_name, pfkc.ordinal_position
    """
    fk_data = execute_query(query, (target_table_id,))
    
    if fk_data:
        # –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –≤–Ω–µ—à–Ω–∏–º –∫–ª—é—á–∞–º
        foreign_keys = {}
        for row in fk_data:
            constraint_name = row['constraint_name']
            if constraint_name not in foreign_keys:
                foreign_keys[constraint_name] = {
                    'referenced_table_id': row['referenced_table_id'],
                    'delete_action': row['delete_action'],
                    'update_action': row['update_action'],
                    'columns': []
                }
            foreign_keys[constraint_name]['columns'].append({
                'column': row['column_name'],
                'referenced_column': row['referenced_column_name']
            })
        
        # –°–æ–∑–¥–∞–Ω–∏–µ –≤–Ω–µ—à–Ω–∏—Ö –∫–ª—é—á–µ–π
        for constraint_name, fk_info in foreign_keys.items():
            columns = [col['column'] for col in fk_info['columns']]
            referenced_columns = [col['referenced_column'] for col in fk_info['columns']]
            
            # –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–º–µ–Ω–∏ —Å—Å—ã–ª–æ—á–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã
            ref_table_name = get_referenced_table_name(fk_info['referenced_table_id'])
            
            ddl = f"""ALTER TABLE ags.{table_name} 
ADD CONSTRAINT {constraint_name} 
FOREIGN KEY ({', '.join(columns)}) 
REFERENCES ags.{ref_table_name} ({', '.join(referenced_columns)})
ON DELETE {fk_info['delete_action']} ON UPDATE {fk_info['update_action']};"""
            execute_ddl(ddl)
            console.print(f"[green]‚úÖ –í–Ω–µ—à–Ω–∏–π –∫–ª—é—á {constraint_name} —Å–æ–∑–¥–∞–Ω[/green]")

def create_unique_constraints(target_table_id, table_name):
    """–°–æ–∑–¥–∞–Ω–∏–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π"""
    query = """
    SELECT 
        puc.constraint_name,
        pucc.ordinal_position,
        pc.column_name
    FROM mcl.postgres_unique_constraints puc
    JOIN mcl.postgres_unique_constraint_columns pucc ON puc.id = pucc.unique_constraint_id
    JOIN mcl.postgres_columns pc ON pucc.column_id = pc.id
    WHERE puc.table_id = %s
    ORDER BY puc.constraint_name, pucc.ordinal_position
    """
    uc_data = execute_query(query, (target_table_id,))
    
    if uc_data:
        # –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º
        unique_constraints = {}
        for row in uc_data:
            constraint_name = row['constraint_name']
            if constraint_name not in unique_constraints:
                unique_constraints[constraint_name] = []
            unique_constraints[constraint_name].append(row['column_name'])
        
        # –°–æ–∑–¥–∞–Ω–∏–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
        for constraint_name, columns in unique_constraints.items():
            ddl = f"ALTER TABLE ags.{table_name} ADD CONSTRAINT {constraint_name} UNIQUE ({', '.join(columns)});"
            execute_ddl(ddl)
            console.print(f"[green]‚úÖ –£–Ω–∏–∫–∞–ª—å–Ω–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ {constraint_name} —Å–æ–∑–¥–∞–Ω–æ[/green]")

def create_check_constraints(target_table_id, table_name):
    """–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–æ—á–Ω—ã—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π"""
    query = """
    SELECT 
        pcc.constraint_name,
        pcc.check_definition
    FROM mcl.postgres_check_constraints pcc
    WHERE pcc.table_id = %s
    """
    cc_data = execute_query(query, (target_table_id,))
    
    if cc_data:
        for row in cc_data:
            ddl = f"ALTER TABLE ags.{table_name} ADD CONSTRAINT {row['constraint_name']} CHECK ({row['check_definition']});"
            execute_ddl(ddl)
            console.print(f"[green]‚úÖ –ü—Ä–æ–≤–µ—Ä–æ—á–Ω–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ {row['constraint_name']} —Å–æ–∑–¥–∞–Ω–æ[/green]")

def create_triggers(target_table_id, table_name):
    """–°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤"""
    query = """
    SELECT 
        pt.trigger_name,
        pt.trigger_event,
        pt.trigger_timing,
        pt.trigger_definition
    FROM mcl.postgres_triggers pt
    WHERE pt.table_id = %s
    """
    trigger_data = execute_query(query, (target_table_id,))
    
    if trigger_data:
        for row in trigger_data:
            ddl = f"""CREATE TRIGGER {row['trigger_name']}
    {row['trigger_timing']} {row['trigger_event']} ON ags.{table_name}
    FOR EACH ROW
    EXECUTE FUNCTION {row['trigger_definition']};"""
            execute_ddl(ddl)
            console.print(f"[green]‚úÖ –¢—Ä–∏–≥–≥–µ—Ä {row['trigger_name']} —Å–æ–∑–¥–∞–Ω[/green]")

def create_sequences(target_table_id, table_name):
    """–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π"""
    query = """
    SELECT 
        ps.sequence_name,
        ps.start_value,
        ps.minimum_value,
        ps.maximum_value,
        ps.increment,
        ps.cycle_option
    FROM mcl.postgres_sequences ps
    WHERE ps.table_id = %s
    """
    sequence_data = execute_query(query, (target_table_id,))
    
    if sequence_data:
        for row in sequence_data:
            ddl = f"""CREATE SEQUENCE ags.{row['sequence_name']}
    START WITH {row['start_value']}
    INCREMENT BY {row['increment']}
    MINVALUE {row['minimum_value']}
    MAXVALUE {row['maximum_value']}
    {'CYCLE' if row['cycle_option'] else 'NO CYCLE'};"""
            execute_ddl(ddl)
            console.print(f"[green]‚úÖ –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å {row['sequence_name']} —Å–æ–∑–¥–∞–Ω–∞[/green]")

def verify_table_elements(table_name):
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª–Ω–æ—Ç—ã –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Ç–∞–±–ª–∏—Ü—ã"""
    query = """
    SELECT 
        'columns' as element_type,
        COUNT(*) as count
    FROM information_schema.columns 
    WHERE table_schema = 'ags' AND table_name = %s

    UNION ALL

    SELECT 
        'primary_keys' as element_type,
        COUNT(*) as count
    FROM information_schema.table_constraints 
    WHERE table_schema = 'ags' AND table_name = %s 
    AND constraint_type = 'PRIMARY KEY'

    UNION ALL

    SELECT 
        'indexes' as element_type,
        COUNT(*) as count
    FROM pg_indexes 
    WHERE schemaname = 'ags' AND tablename = %s

    UNION ALL

    SELECT 
        'foreign_keys' as element_type,
        COUNT(*) as count
    FROM information_schema.table_constraints 
    WHERE table_schema = 'ags' AND table_name = %s 
    AND constraint_type = 'FOREIGN KEY'

    UNION ALL

    SELECT 
        'unique_constraints' as element_type,
        COUNT(*) as count
    FROM information_schema.table_constraints 
    WHERE table_schema = 'ags' AND table_name = %s 
    AND constraint_type = 'UNIQUE'

    UNION ALL

    SELECT 
        'check_constraints' as element_type,
        COUNT(*) as count
    FROM information_schema.table_constraints 
    WHERE table_schema = 'ags' AND table_name = %s 
    AND constraint_type = 'CHECK'

    UNION ALL

    SELECT 
        'triggers' as element_type,
        COUNT(*) as count
    FROM information_schema.triggers 
    WHERE event_object_schema = 'ags' AND event_object_table = %s

    UNION ALL

    SELECT 
        'sequences' as element_type,
        COUNT(*) as count
    FROM information_schema.sequences 
    WHERE sequence_schema = 'ags' AND sequence_name LIKE %s
    """
    results = execute_query(query, (table_name, table_name, table_name, table_name, table_name, table_name, table_name, f"{table_name}%"))
    
    console.print(f"[blue]üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Ç–∞–±–ª–∏—Ü—ã {table_name}:[/blue]")
    for result in results:
        console.print(f"  {result['element_type']}: {result['count']}")
    
    return True

def get_table_name(target_table_id):
    """–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–º–µ–Ω–∏ —Ç–∞–±–ª–∏—Ü—ã –ø–æ ID"""
    query = "SELECT object_name FROM mcl.postgres_tables WHERE id = %s"
    result = execute_query(query, (target_table_id,))
    return result[0]['object_name'] if result else None

def get_referenced_table_name(referenced_table_id):
    """–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–º–µ–Ω–∏ —Å—Å—ã–ª–æ—á–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã –ø–æ ID"""
    query = "SELECT object_name FROM mcl.postgres_tables WHERE id = %s"
    result = execute_query(query, (referenced_table_id,))
    return result[0]['object_name'] if result else None

# ============================================================================
# –§–£–ù–ö–¶–ò–ò –î–õ–Ø –û–ü–†–ï–î–ï–õ–ï–ù–ò–Ø –°–í–û–ô–°–¢–í –í–°–ï–• –≠–õ–ï–ú–ï–ù–¢–û–í –¢–ê–ë–õ–ò–¶–´
# ============================================================================

def resolve_columns_metadata_correct(table_info):
    """–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–ª–æ–Ω–æ–∫ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ø—Ä—è–º—ã—Ö —Å—Å—ã–ª–æ–∫ source_column_id"""
    
    query = """
    SELECT 
        -- –ò—Å—Ö–æ–¥–Ω—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞
        mc.id as source_column_id,
        mc.column_name as source_column_name,
        mc.ordinal_position as source_ordinal_position,
        mc.default_value as source_default_value,
        mc.is_identity as source_is_identity,
        mc.identity_seed as source_identity_seed,
        mc.identity_increment as source_identity_increment,
        mc.is_computed as source_is_computed,
        mc.computed_definition as source_computed_definition,
        mc.is_persisted as source_is_persisted,
        mc.column_description as source_description,
        
        -- –¶–µ–ª–µ–≤—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞
        pc.id as target_column_id,
        pc.column_name as target_column_name,
        pc.ordinal_position as target_ordinal_position,
        pc.default_value as target_default_value,
        pc.is_identity as target_is_identity,
        pc.identity_seed as target_identity_seed,
        pc.identity_increment as target_identity_increment,
        pc.is_computed as target_is_computed,
        pc.computed_definition as target_computed_definition,
        pc.column_description as target_description,
        
        -- –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö
        pdt.typname_with_params as target_data_type,
        pdt.typname as base_type,
        
        -- –°—Ç–∞—Ç—É—Å –º–∏–≥—Ä–∞—Ü–∏–∏
        pc.type_mapping_quality,
        pc.data_type_migration_status,
        pc.data_type_migration_notes,
        
        -- –ü—Ä—è–º–∞—è —Å–≤—è–∑—å
        pc.source_column_id as direct_source_reference
        
    FROM mcl.postgres_columns pc
    JOIN mcl.mssql_columns mc ON pc.source_column_id = mc.id
    JOIN mcl.postgres_derived_types pdt ON pc.postgres_data_type_id = pdt.id
    WHERE pc.table_id = %s
    ORDER BY pc.ordinal_position
    """
    
    return execute_query(query, (table_info['target_table_id'],))

def resolve_primary_keys_metadata_correct(table_info):
    """–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–µ—Ä–≤–∏—á–Ω—ã—Ö –∫–ª—é—á–µ–π —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ø—Ä—è–º—ã—Ö —Å—Å—ã–ª–æ–∫"""
    
    # –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–µ—Ä–≤–∏—á–Ω–æ–º –∫–ª—é—á–µ
    pk_query = """
    SELECT 
        -- –ò—Å—Ö–æ–¥–Ω—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞
        mpk.id as source_primary_key_id,
        mpk.constraint_name as source_constraint_name,
        mpk.is_clustered as source_is_clustered,
        mpk.pk_type as source_pk_type,
        mpk.pk_ordinal_position as source_ordinal_position,
        
        -- –¶–µ–ª–µ–≤—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞
        ppk.id as target_primary_key_id,
        ppk.constraint_name as target_constraint_name,
        ppk.is_clustered as target_is_clustered,
        ppk.created_at as target_created_at,
        ppk.updated_at as target_updated_at,
        
        -- –ü—Ä—è–º–∞—è —Å–≤—è–∑—å
        ppk.source_primary_key_id as direct_source_reference
        
    FROM mcl.postgres_primary_keys ppk
    JOIN mcl.mssql_primary_keys mpk ON ppk.source_primary_key_id = mpk.id
    WHERE ppk.table_id = %s
    """
    
    # –ö–æ–ª–æ–Ω–∫–∏ –ø–µ—Ä–≤–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞
    pk_columns_query = """
    SELECT 
        ppkc.column_name as target_column_name,
        ppkc.ordinal_position,
        ppkc.is_descending as target_is_descending,
        ppkc.created_at,
        ppkc.updated_at
        
    FROM mcl.postgres_primary_key_columns ppkc
    JOIN mcl.postgres_primary_keys ppk ON ppkc.primary_key_id = ppk.id
    WHERE ppk.table_id = %s
    ORDER BY ppkc.ordinal_position
    """
    
    return {
        'primary_key': execute_query(pk_query, (table_info['target_table_id'],)),
        'columns': execute_query(pk_columns_query, (table_info['target_table_id'],))
    }

def resolve_foreign_keys_metadata_correct(table_info):
    """–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤–Ω–µ—à–Ω–∏—Ö –∫–ª—é—á–µ–π —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ø—Ä—è–º—ã—Ö —Å—Å—ã–ª–æ–∫"""
    
    query = """
    SELECT 
        -- –ò—Å—Ö–æ–¥–Ω—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞
        mfk.id as source_foreign_key_id,
        mfk.constraint_name as source_constraint_name,
        mfk.referenced_table_name as source_referenced_table,
        mfk.delete_action as source_delete_action,
        mfk.update_action as source_update_action,
        mfk.is_disabled as source_is_disabled,
        mfk.is_not_trusted as source_is_not_trusted,
        
        -- –¶–µ–ª–µ–≤—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞
        pfk.id as target_foreign_key_id,
        pfk.constraint_name as target_constraint_name,
        pfk.original_constraint_name,
        pfk.delete_action as target_delete_action,
        pfk.update_action as target_update_action,
        pfk.migration_status,
        pfk.migration_date,
        pfk.error_message,
        
        -- –ü—Ä—è–º–∞—è —Å–≤—è–∑—å
        pfk.source_foreign_key_id as direct_source_reference,
        pfk.referenced_table_id,
        pfk.created_at,
        pfk.updated_at
        
    FROM mcl.postgres_foreign_keys pfk
    JOIN mcl.mssql_foreign_keys mfk ON pfk.source_foreign_key_id = mfk.id
    WHERE pfk.table_id = %s
    ORDER BY pfk.constraint_name
    """
    
    # –ö–æ–ª–æ–Ω–∫–∏ –≤–Ω–µ—à–Ω–µ–≥–æ –∫–ª—é—á–∞
    fk_columns_query = """
    SELECT 
        pfkc.column_name as target_column_name,
        pfkc.referenced_column_name as target_referenced_column,
        pfkc.ordinal_position,
        pfkc.created_at,
        pfkc.updated_at
        
    FROM mcl.postgres_foreign_key_columns pfkc
    JOIN mcl.postgres_foreign_keys pfk ON pfkc.foreign_key_id = pfk.id
    WHERE pfk.table_id = %s
    ORDER BY pfk.constraint_name, pfkc.ordinal_position
    """
    
    return {
        'foreign_keys': execute_query(query, (table_info['target_table_id'],)),
        'columns': execute_query(fk_columns_query, (table_info['target_table_id'],))
    }

def resolve_indexes_metadata_correct(table_info):
    """–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ø—Ä—è–º—ã—Ö —Å—Å—ã–ª–æ–∫"""
    
    query = """
    SELECT 
        -- –ò—Å—Ö–æ–¥–Ω—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞
        mi.id as source_index_id,
        mi.index_name as source_index_name,
        mi.index_type as source_index_type,
        mi.is_unique as source_is_unique,
        mi.is_primary_key as source_is_primary_key,
        mi.is_disabled as source_is_disabled,
        mi.fill_factor as source_fill_factor,
        mi.is_padded as source_is_padded,
        mi.allow_row_locks as source_allow_row_locks,
        mi.allow_page_locks as source_allow_page_locks,
        
        -- –¶–µ–ª–µ–≤—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞
        pi.id as target_index_id,
        pi.index_name as target_index_name,
        pi.original_index_name,
        pi.index_type as target_index_type,
        pi.is_unique as target_is_unique,
        pi.is_primary_key as target_is_primary_key,
        pi.fill_factor as target_fill_factor,
        pi.is_concurrent as target_is_concurrent,
        
        -- –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –∏–º–µ–Ω
        pi.name_conflict_resolved,
        pi.name_conflict_reason,
        pi.alternative_name,
        
        -- –°—Ç–∞—Ç—É—Å –º–∏–≥—Ä–∞—Ü–∏–∏
        pi.migration_status,
        pi.migration_date,
        pi.error_message,
        
        -- –ü—Ä—è–º–∞—è —Å–≤—è–∑—å
        pi.source_index_id as direct_source_reference,
        pi.created_at,
        pi.updated_at
        
    FROM mcl.postgres_indexes pi
    JOIN mcl.mssql_indexes mi ON pi.source_index_id = mi.id
    WHERE pi.table_id = %s
    ORDER BY pi.index_name
    """
    
    # –ö–æ–ª–æ–Ω–∫–∏ –∏–Ω–¥–µ–∫—Å–∞
    index_columns_query = """
    SELECT 
        pic.column_name as target_column_name,
        pic.ordinal_position,
        pic.is_descending as target_is_descending,
        pic.key_ordinal as target_key_ordinal,
        pic.created_at,
        pic.updated_at
        
    FROM mcl.postgres_index_columns pic
    JOIN mcl.postgres_indexes pi ON pic.index_id = pi.id
    WHERE pi.table_id = %s
    ORDER BY pi.index_name, pic.ordinal_position
    """
    
    return {
        'indexes': execute_query(query, (table_info['target_table_id'],)),
        'columns': execute_query(index_columns_query, (table_info['target_table_id'],))
    }

def resolve_complete_table_metadata_correct(table_name):
    """–ü–æ–ª–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Ç–∞–±–ª–∏—Ü—ã —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ø—Ä—è–º—ã—Ö —Å—Å—ã–ª–æ–∫"""
    
    # 1. –ü–æ–ª—É—á–µ–Ω–∏–µ –±–∞–∑–æ–≤—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ç–∞–±–ª–∏—Ü—ã
    table_info = validate_migration_parameters_from_metadata(table_name)
    
    # 2. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Ç–∞–±–ª–∏—Ü—ã —á–µ—Ä–µ–∑ –ø—Ä—è–º—ã–µ —Å—Å—ã–ª–∫–∏
    elements = {
        'columns': resolve_columns_metadata_correct(table_info),
        'primary_keys': resolve_primary_keys_metadata_correct(table_info),
        'foreign_keys': resolve_foreign_keys_metadata_correct(table_info),
        'indexes': resolve_indexes_metadata_correct(table_info)
    }
    
    return {
        'table': table_info,
        'elements': elements,
        'migration_status': 'ready_for_migration'
    }

if __name__ == "__main__":
    # –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –º–∏–≥—Ä–∞—Ü–∏–∏ - —Ç–æ–ª—å–∫–æ –∏–º—è —Ç–∞–±–ª–∏—Ü—ã
    TABLE_NAME = "cnInvCmmAgN"  # –ò–º—è —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏
    
    success = migrate_single_table(TABLE_NAME)
    sys.exit(0 if success else 1)
```

---

## üö® –í–ê–ñ–ù–´–ï –ú–û–ú–ï–ù–¢–´

### **–ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è –º–æ–¥—É–ª–µ–π:**
- **–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** –°—Ç—Ä–æ–≥–æ–µ —Å–æ–±–ª—é–¥–µ–Ω–∏–µ –ø–æ—Ä—è–¥–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–æ–¥—É–ª–µ–π
- **–ü–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö:** –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –º–µ–∂–¥—É –º–æ–¥—É–ª—è–º–∏
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:** –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π

### **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º:**
- **–°—Ç–∞—Ç—É—Å –º–∏–≥—Ä–∞—Ü–∏–∏:** –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —ç—Ç–∞–ø–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞
- **–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ:** –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ –≤ —Å—Ö–µ–º–µ `mcl`
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ó–∞–ø–∏—Å—å –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å:**
- **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å:** –ö–∞–∂–¥—ã–π –º–æ–¥—É–ª—å –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ
- **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å:** –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –º–æ–¥—É–ª–µ–π
- **–ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** –ú–æ–¥—É–ª–∏ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è –¥—Ä—É–≥–∏—Ö —Ç–∞–±–ª–∏—Ü

### **–í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:** –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:** –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–ª–∞—Å—Å—ã –æ—à–∏–±–æ–∫ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –ø—Ä–æ–±–ª–µ–º
- **–¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö:** –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä –∏—Å—Ö–æ–¥–Ω–æ–π –∏ —Ü–µ–ª–µ–≤–æ–π —Ç–∞–±–ª–∏—Ü
- **–û—Ç–∫–∞—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–∫–∞—Ç –ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–∫–∞—Ö

### **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
- **–ü–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞:** –î–ª—è –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü (>1M —Å—Ç—Ä–æ–∫) –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å batch processing
- **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤:** –°–æ–∑–¥–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤ –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –ø–µ—Ä–µ–Ω–æ—Å–∞
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤:** –ö–æ–Ω—Ç—Ä–æ–ª—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–∞–º—è—Ç–∏ –∏ –¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞

---

## üìû –ü–û–î–î–ï–†–ñ–ö–ê

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é –ø—Ä–∞–≤–∏–ª:
1. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–º—É –º–æ–¥—É–ª—é –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —ç—Ç–∞–ø–æ–≤
3. –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –º–æ–¥—É–ª—è–º–∏

---

*–î–æ–∫—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω: 2025-01-27*  
*–í–µ—Ä—Å–∏—è: 1.0*  
*–°—Ç–∞—Ç—É—Å: –ê–ö–¢–£–ê–õ–¨–ù–´–ô*  
*–¢–∏–ø: –¶–ï–ù–¢–†–ê–õ–¨–ù–´–ô –ú–û–î–£–õ–¨ –°–ò–°–¢–ï–ú–´ –ü–†–ê–í–ò–õ*