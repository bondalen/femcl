{
  "modules": {
    "metadata": {
      "version": "1.0.0",
      "lastUpdated": "2025-10-06",
      "description": "Архитектура модулей системы миграции БД",
      "status": "operational"
    },
    "list": [
      {
        "module": {
          "id": "metadataGeneration",
          "attributes": {
            "name": "Модуль формирования метаданных",
            "description": "Создание схемы mcl в целевой БД",
            "purpose": "Анализ исходной БД и запись метаданных в mcl",
            "status": "planned",
            "location": "src/code/metadata/",
            "entryPoint": "src/code/metadata/scripts/generate_metadata.py",
            "dependencies": []
          },
          "components": [
            {
              "component": {
                "id": "analyzer",
                "attributes": {
                  "name": "Metadata Analyzer",
                  "description": "Извлечение структуры исходной БД",
                  "type": "classes",
                  "location": "src/code/metadata/classes/",
                  "responsibilities": ["Сканирование схем MS SQL", "Извлечение объектов БД", "Построение графа зависимостей"],
                  "status": "planned"
                },
                "classes": [
                  {
                    "class": {
                      "id": "Analyzer",
                      "attributes": {
                        "name": "Analyzer",
                        "location": "src/code/metadata/classes/analyzer.py",
                        "responsibilities": ["Сканирование и каталогизация объектов БД"],
                        "dependsOn": ["ConnectionManager"],
                        "status": "planned"
                      }
                    }
                  }
                ]
              }
            },
            {
              "component": {
                "id": "transformer",
                "attributes": {
                  "name": "Metadata Transformer",
                  "description": "Нормализация метаданных под PostgreSQL",
                  "type": "classes",
                  "location": "src/code/metadata/classes/",
                  "responsibilities": ["Маппинг типов данных", "Обработка вычисляемых колонок", "Преобразование функций"],
                  "status": "planned"
                },
                "classes": [
                  {
                    "class": {
                      "id": "Transformer",
                      "attributes": {
                        "name": "Transformer",
                        "location": "src/code/metadata/classes/transformer.py",
                        "responsibilities": ["Преобразование метаданных MS SQL → PostgreSQL"],
                        "dependsOn": ["FunctionMappingModel"],
                        "status": "planned"
                      }
                    }
                  }
                ]
              }
            },
            {
              "component": {
                "id": "writer",
                "attributes": {
                  "name": "Metadata Writer",
                  "description": "Запись метаданных в схему mcl",
                  "type": "classes",
                  "location": "src/code/metadata/classes/",
                  "responsibilities": ["Заполнение таблиц mcl.*", "Валидация ссылочной целостности"],
                  "status": "planned"
                },
                "classes": [
                  {
                    "class": {
                      "id": "Writer",
                      "attributes": {
                        "name": "Writer",
                        "location": "src/code/metadata/classes/writer.py",
                        "responsibilities": ["Запись метаданных в БД"],
                        "dependsOn": ["ConfigLoader", "ConnectionManager"],
                        "status": "planned"
                      }
                    }
                  }
                ],
                "scripts": ["src/code/metadata/scripts/generate_metadata.py"]
              }
            }
          ]
        }
      },
      {
        "module": {
          "id": "dataMigration",
          "attributes": {
            "name": "Модуль переноса данных",
            "description": "Перенос данных по метаданным из схемы mcl",
            "purpose": "DDL → Data → Indexes → FKs → Validation",
            "status": "implemented",
            "location": "src/code/migration/",
            "entryPoint": "src/code/migration/scripts/migrate_table.py",
            "dependencies": ["metadataGeneration", "infrastructure"]
          },
          "components": [
            {
              "component": {
                "id": "migrator",
                "attributes": {
                  "name": "Table Migrator",
                  "description": "Оркестрация миграции одной таблицы",
                  "type": "classes",
                  "location": "src/code/migration/classes/",
                  "responsibilities": ["Создание таблицы", "Перенос данных", "Создание индексов и ограничений", "Валидация результатов"],
                  "status": "implemented"
                },
                "classes": [
                  {
                    "class": {
                      "id": "TableMigrator",
                      "attributes": {
                        "name": "TableMigrator",
                        "location": "src/code/migration/classes/table_migrator.py",
                        "responsibilities": ["Полный цикл миграции таблицы"],
                        "dependsOn": ["TableModel", "ConfigLoader", "ConnectionManager"],
                        "status": "implemented"
                      }
                    }
                  }
                ],
                "scripts": ["src/code/migration/scripts/migrate_table.py"]
              }
            },
            {
              "component": {
                "id": "tableModels",
                "attributes": {
                  "name": "Table Models",
                  "description": "Модели таблиц для миграции",
                  "type": "classes",
                  "location": "src/code/migration/classes/",
                  "responsibilities": ["Загрузка метаданных из mcl", "Генерация DDL", "Обработка вычисляемых колонок → представления"],
                  "status": "implemented"
                },
                "classes": [
                  {
                    "class": {
                      "id": "TableModel",
                      "attributes": {
                        "name": "TableModel",
                        "location": "src/code/migration/classes/table_model.py",
                        "responsibilities": ["Абстрактная базовая модель таблицы"],
                        "dependsOn": [],
                        "status": "implemented"
                      }
                    }
                  },
                  {
                    "class": {
                      "id": "RegularTableModel",
                      "attributes": {
                        "name": "RegularTableModel",
                        "location": "src/code/migration/classes/regular_table_model.py",
                        "responsibilities": ["Модель обычной таблицы без вычисляемых колонок"],
                        "dependsOn": ["TableModel"],
                        "status": "implemented"
                      }
                    }
                  },
                  {
                    "class": {
                      "id": "BaseTableModel",
                      "attributes": {
                        "name": "BaseTableModel",
                        "location": "src/code/migration/classes/base_table_model.py",
                        "responsibilities": ["Таблицы с вычисляемыми колонками → базовая таблица + представление"],
                        "dependsOn": ["TableModel", "ViewModel"],
                        "status": "implemented"
                      }
                    }
                  },
                  {
                    "class": {
                      "id": "ViewModel",
                      "attributes": {
                        "name": "ViewModel",
                        "location": "src/code/migration/classes/view_model.py",
                        "responsibilities": ["Генерация DDL для представлений"],
                        "dependsOn": [],
                        "status": "implemented"
                      }
                    }
                  }
                ]
              }
            },
            {
              "component": {
                "id": "dataElements",
                "attributes": {
                  "name": "Data Element Models",
                  "description": "Модели элементов таблиц: колонки, индексы, ключи, ограничения, триггеры, последовательности",
                  "type": "classes",
                  "location": "src/code/migration/classes/",
                  "responsibilities": ["Представление элементов БД", "Генерация DDL для элементов"],
                  "status": "implemented"
                },
                "classes": [
                  {
                    "class": {
                      "id": "ColumnModel",
                      "attributes": {
                        "name": "ColumnModel",
                        "location": "src/code/migration/classes/column_model.py",
                        "responsibilities": ["Модель колонки таблицы"],
                        "dependsOn": [],
                        "status": "implemented"
                      }
                    }
                  },
                  {
                    "class": {
                      "id": "ComputedColumnModel",
                      "attributes": {
                        "name": "ComputedColumnModel",
                        "location": "src/code/migration/classes/computed_column_model.py",
                        "responsibilities": ["Модель вычисляемой колонки"],
                        "dependsOn": ["ColumnModel"],
                        "status": "implemented"
                      }
                    }
                  },
                  {
                    "class": {
                      "id": "IndexModel",
                      "attributes": {
                        "name": "IndexModel",
                        "location": "src/code/migration/classes/index_model.py",
                        "responsibilities": ["Модель индекса"],
                        "dependsOn": ["IndexColumnModel"],
                        "status": "implemented"
                      }
                    }
                  },
                  {
                    "class": {
                      "id": "IndexColumnModel",
                      "attributes": {
                        "name": "IndexColumnModel",
                        "location": "src/code/migration/classes/index_column_model.py",
                        "responsibilities": ["Модель колонки индекса"],
                        "dependsOn": [],
                        "status": "implemented"
                      }
                    }
                  },
                  {
                    "class": {
                      "id": "ForeignKeyModel",
                      "attributes": {
                        "name": "ForeignKeyModel",
                        "location": "src/code/migration/classes/foreign_key_model.py",
                        "responsibilities": ["Модель внешнего ключа"],
                        "dependsOn": [],
                        "status": "implemented"
                      }
                    }
                  },
                  {
                    "class": {
                      "id": "UniqueConstraintModel",
                      "attributes": {
                        "name": "UniqueConstraintModel",
                        "location": "src/code/migration/classes/unique_constraint_model.py",
                        "responsibilities": ["Модель ограничения UNIQUE"],
                        "dependsOn": [],
                        "status": "implemented"
                      }
                    }
                  },
                  {
                    "class": {
                      "id": "CheckConstraintModel",
                      "attributes": {
                        "name": "CheckConstraintModel",
                        "location": "src/code/migration/classes/check_constraint_model.py",
                        "responsibilities": ["Модель ограничения CHECK"],
                        "dependsOn": [],
                        "status": "implemented"
                      }
                    }
                  },
                  {
                    "class": {
                      "id": "DefaultConstraintModel",
                      "attributes": {
                        "name": "DefaultConstraintModel",
                        "location": "src/code/migration/classes/default_constraint_model.py",
                        "responsibilities": ["Модель ограничения DEFAULT"],
                        "dependsOn": [],
                        "status": "implemented"
                      }
                    }
                  },
                  {
                    "class": {
                      "id": "TriggerModel",
                      "attributes": {
                        "name": "TriggerModel",
                        "location": "src/code/migration/classes/trigger_model.py",
                        "responsibilities": ["Модель триггера"],
                        "dependsOn": [],
                        "status": "implemented"
                      }
                    }
                  },
                  {
                    "class": {
                      "id": "SequenceModel",
                      "attributes": {
                        "name": "SequenceModel",
                        "location": "src/code/migration/classes/sequence_model.py",
                        "responsibilities": ["Модель последовательности"],
                        "dependsOn": [],
                        "status": "implemented"
                      }
                    }
                  }
                ]
              }
            }
          ]
        }
      },
      {
        "module": {
          "id": "infrastructure",
          "attributes": {
            "name": "Модуль инфраструктуры",
            "description": "Общие сервисы для всех модулей",
            "purpose": "Подключения к БД, конфигурация, утилиты",
            "status": "implemented",
            "location": "src/code/infrastructure/",
            "dependencies": []
          },
          "components": [
            {
              "component": {
                "id": "connections",
                "attributes": {
                  "name": "Connection Manager",
                  "description": "Управление подключениями к БД",
                  "type": "classes",
                  "location": "src/code/infrastructure/classes/",
                  "responsibilities": ["Подключение к MS SQL Server", "Подключение к PostgreSQL", "Управление пулом соединений", "Обработка ошибок подключения"],
                  "status": "planned"
                },
                "classes": [
                  {
                    "class": {
                      "id": "ConnectionManager",
                      "attributes": {
                        "name": "ConnectionManager",
                        "location": "src/code/infrastructure/classes/connection_manager.py",
                        "responsibilities": ["Создание и управление подключениями к БД"],
                        "dependsOn": ["ConfigLoader"],
                        "status": "planned"
                      }
                    }
                  }
                ]
              }
            },
            {
              "component": {
                "id": "config",
                "attributes": {
                  "name": "Config Loader",
                  "description": "Загрузка и управление конфигурацией",
                  "type": "config",
                  "location": "src/code/infrastructure/config/",
                  "responsibilities": ["Парсинг конфигурационных файлов", "Валидация настроек", "Предоставление доступа к конфигурации"],
                  "status": "implemented"
                },
                "classes": [
                  {
                    "class": {
                      "id": "ConfigLoader",
                      "attributes": {
                        "name": "ConfigLoader",
                        "location": "src/code/infrastructure/config/config_loader.py",
                        "responsibilities": ["Загрузка и предоставление доступа к конфигурации приложения и БД"],
                        "dependsOn": [],
                        "status": "implemented"
                      }
                    }
                  }
                ],
                "files": ["src/code/infrastructure/config/config.yaml", "src/code/infrastructure/config/README.md"]
              }
            },
            {
              "component": {
                "id": "functionMapping",
                "attributes": {
                  "name": "Function Mapping",
                  "description": "Маппинг функций между MS SQL и PostgreSQL",
                  "type": "classes",
                  "location": "src/code/infrastructure/classes/",
                  "responsibilities": ["Справочник функций MS SQL → PostgreSQL", "Политики преобразования функций"],
                  "status": "implemented"
                },
                "classes": [
                  {
                    "class": {
                      "id": "FunctionMappingModel",
                      "attributes": {
                        "name": "FunctionMappingModel",
                        "location": "src/code/infrastructure/classes/function_mapping_model.py",
                        "responsibilities": ["Модель маппинга функций между БД"],
                        "dependsOn": [],
                        "status": "implemented"
                      }
                    }
                  },
                  {
                    "class": {
                      "id": "FunctionMappingState",
                      "attributes": {
                        "name": "FunctionMappingState",
                        "location": "src/code/infrastructure/classes/function_mapping_state.py",
                        "responsibilities": ["Состояние маппинга функций"],
                        "dependsOn": ["FunctionMappingModel"],
                        "status": "implemented"
                      }
                    }
                  }
                ]
              }
            }
          ]
        }
      }
    ]
  }
}
